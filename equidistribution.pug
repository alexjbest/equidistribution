introduction
    aside: p Lecture 1 6/9/2018
    p.
        These are notes for Ali Altuğ's course MA841 at BU Fall 2018.

    p.
        The course webpage is #[url(href="http://math.bu.edu/people/saaltug/2018_3/2018_3_sem.html")/].
    p.
        Course overview:

        Upon Akshay Venkatesh winning the fields medal I decided to dedicate this term to various aspects of equidistribution results in number theory and their relations to L-functions. I am aiming to cover basic results like Linnik's and Duke's theorems, as well as certain aspects of subconvexity. As we move along we may briefly touch several other aspects like quantum unique ergodicity (QUE) or equidistribution in other settings (e.g. over function fields).

        There is an abundance of material on this topic. We will not follow a single book or an article (although the first book and the survey articles following that will be the main reference), however here are a bunch of helpful papers/books. I will update these references as we move along.

section#sec-equidistribution-intro
    title Equidistribution in Number Theory
    subsection#subsec-equidistribution-introduction
        title Introduction

        blockquote
            p I wasn't going to do this at all, but then Akshay won the Fields medal.
            attribution
                line Ali Altuğ

        p
            | Some topics we will try and cover:
            ol
                li
                    | Linnik's and Duke's theorem 1970-1990
                li
                    | lattice points and hyperbolic geometry
                li
                    | modular forms
                li
                    | spectral theory
                li
                    | modular forms of half-integral weight.
                li
                    | harmonic analysis
                li
                    | Kuznetsov formula
                li
                    | Other topics!

    subsection#subsec-linnik-duke
        title Linnik and Duke

        p
            | Akshay's first breakthrough, according to Sarnak, was subconvexity.
            | He became interested in ergodic theory, because they could prove hard theorems, equidistribution is a powerful tool in number theory.

        p
            | Our main goal will be to talk about: Some problems stated (and proved) by Linnik.
            | In the book, Ergodic properties of algebraic fields, 1968.
            | He considered lattice points on a sphere of radius #[m n], these are points (say in #[m \RR^3]) whose coordinates are integral of a fixed distance from the origin.
            | Analogous to the circle problem.
            | If #[m n] is fixed there is nothing to distribute, but if we vary #[m n] and project down we can ask do they accumulate miss any patches, generally how do they distribute.

            | Of course this can be generalised.

        paragraphs
            title Setup

            p
                | Sphere #[m S^2].
            p
                | Lattice points #[m \alpha = (x_1, x_2, x_3) \in \ZZ^3].
            p
                me |\alpha|^2 =  x_1^2 + x_2^2 + x_3^2
                | this is where the number theory comes, we are looking at representability of numbers #[m n] by this ternary quadratic form.
            p
                | Various methods exist for studying this for varying #[m n], quadratic reciprocity for #[m n=2], circle method/Vinogradov for #[m n=4].
                | #[m n=3] is the cut off, here half-integral weight modular forms are relevant.

            p
                | Set
                me \Omega_N = \left\{x= \frac{\alpha}{|\alpha|} : \alpha \in \ZZ^2 ,\,|\alpha|^2 = N \right\}\subseteq S^2
                | .

        question
            statement: p
                | Are #[m \Omega_N] #[q equidistributed]  as #[m N \to \infty]?

        p
            | There is an immediate obstruction to #[m N] being a sum of #[m 3] squares, e.g. #[m N = 7] implies #[m \Omega_7 = \emptyset].
        p
            | Recall: (Gauss/Legendre)
            me N = x_1^2 + x_2^2+ x_3^2,\,x_i \in \ZZ \iff N \ne 4^a(8b+7)
            | , so we avoid these sets and ask the same question.

        theorem#thm-linnik
            title Linnik
            statement: p
                | Let #[m f \in \cinf(S^2)], then as #[m N \to \infty], #[m N] squarefree #[m N \not\equiv 7 \pmod 8], #[m \legendre{N}{p} = 1] for some fixed odd prime #[m p]
                me \frac{1}{\# \Omega_N} \sum_{x\in \Omega_N} f(x) \to \int_{S^2} f\diff \sigma
                | where #[m \diff \sigma] is the Lebesgue measure on #[m S^2].

        p
            | This is saying that the points are equidistributed with respect to the Lebesgue measure.

        p
            | The last condition is a defect of the method, known as a Linnik condition.

        remark: p
            | Linnik's proof is ergodic theoretic.
        p
            | After this came Duke in 1988, in the mean time, Weil conjectures were proved, Iwaniec gave bounds for Kloosterman sums.
            | Duke was a graduate student of Sarnak at Courant.

            | He gave a more direct proof of #[xref(ref="thm-linnik")/] which does not have the #[m \legendre{N}{p} = 1] condition.
            | His proof is based on the theory of (half-integral weight) modular forms, and a good bound Iwaniec on certain exponential sums.

        p
            | Why do exponential sums enter the picture?
            | We are trying to prove that we have a sum converging to an integral.
            | Generally we work with a basis of functions first, we could try using fourier analysis, using harmonics as our basis, this is when exponential sums appear.
            | That requires us to work out harmonics on the sphere (spherical harmonics) which leads to representation theory, which as the sphere is compact involves Weyl representations etc.
        p
            | Duke also proved #[q the same] theorem over  modular surfaces.
            | Instead of looking at expanding spheres we study expanding hyperboloids.


        paragraphs
            title Setup

            p
                | Space
                me \pm \Gamma\backslash \HH
                me \HH = \left\{ x+iy \in CC : y \gt 0\right\}
                me \Gamma = \SL_2(\ZZ)
                me \mathcal F = \left\{ z\in \HH : -\frac12 \le \Re(z) \le 0, |z| \ge 1 \text{ or }\frac12 \gt \Re(z) \gt 0, |z| \gt 1 \right\}
            figure
                caption #[m \mathcal F]
                image: latex-image.
                    <![CDATA[
                    \begin{tikzpicture}
                        \draw[thick] (-7,0) -- (7,0);
                        \filldraw[fill=gray!20!white, draw=gray!20!white] (1.5,7) -- (1.5,2.598076211) arc (60:120:3cm) -- (-1.5,7) -- (1.5,7);
                        \draw[thick,dotted] (4.5,0) -- (4.5,7);
                        \draw[thick,dotted] (-4.5,0) -- (-4.5,7);
                        \draw[thick,dotted] (6,0) arc (0:180:3cm);
                        \draw[thick,dash dot] (1.5, 2.598076211) -- (1.5,7);
                        \draw[thick,dotted] (1.5, 2.598076211) -- (1.5,0);
                        \draw[thick] (-1.5, 2.598076211) -- (-1.5,7);
                        \draw[thick,dotted] (-1.5, 2.598076211) -- (-1.5,0);
                        \draw[thick,dash dot] (1.5, 2.598076211) arc(60:90:3cm);
                        \draw[thick] (0, 3) arc(90:120:3cm);
                        \draw[thick,dotted] (3,0) arc (0:60:3cm);
                        \draw[thick,dotted] (-1.5, 2.598076211) arc (120:180:3cm);
                        \draw[thick,dotted] (6,0) arc (0:180:3cm);
                        \draw[thick,dotted] (0,0) arc (0:180:3cm);
                        \draw[thick,dotted] (3,0) arc (180:90:3cm);
                        \draw[thick,dotted] (-3,0) arc (0:90:3cm);
                        \draw[thick,dotted] (0,0) arc (0:180:1cm);
                        \draw[thick,dotted] (-3,0) arc (180:0:1cm);
                        \draw[thick,dotted] (-3,0) arc (0:180:1cm);
                        \draw[thick,dotted] (-6,0) arc (180:0:1cm);
                        \draw[thick,dotted] (0,0) arc (180:0:1cm);
                        \draw[thick,dotted] (3,0) arc (0:180:1cm);
                        \draw[thick,dotted] (3,0) arc (180:0:1cm);
                        \draw[thick,dotted] (6,0) arc (0:180:1cm);
                        %\node at (0, 5){$D_w\f M\g$};
                        \node at (0,-.35){$0$};
                        \node at (1.5,-.35){$\frac{1}{2}$};
                        \node at (3,-.35){$1$};
                        \node[inner sep=1.5pt, circle, fill=black]  (p) at (0,3) {};
                        \node at (.15,3.2){$i$};
                        \node[inner sep=1.5pt, circle, fill=black]  (p) at (0,6) {};
                        \node at (.7,6.2){$w=ki$};
                        \node[inner sep=1.5pt, circle, fill=black]  (p) at (1.5,2.598076211) {};
                        %\node at (1.75,2.2){$v_2$};
                        \node at (1.3, 3){$\frac{\pi}{3}$};
                        \node[inner sep=1.5pt, circle, fill=black]  (p) at (-1.5,2.598076211) {};
                        %\node at (-1.25,2.2){$v_1$};
                        \node at (-1.3, 3){$\frac{\pi}{3}$};
                    \end{tikzpicture}
                    ]]>

            p
                | #[m \Omega_N]'s are now replaced with CM points.

        paragraphs
            title Digression (CM points)

            p
                | #[m Q] a binary quadratic form
                me Q(x,y) = ax^2+ bxy + cy^2
                | of discriminant #[m d = b^2-  4ac \lt 0], #[m a,b,c\in \ZZ].
                // TODO do we need a gt 0 here?!

            theorem
                title Gauss
                statement: p
                    | There are only finitely many equivalence classes of such forms for fixed  #[m d].

            p
                | The number of such is given by the Hurwitz class number.
            p
                | Given #[m Q] we associate a CM point
                me z_Q = \frac{-b + \sqrt{d}}{2a} \in \HH
                | .

            p
                | The action of #[m \Gamma] on #[m Q] is the same as the action of #[m \Gamma] on #[m z_Q].
                me z_{\gamma Q }  =\gamma z_Q
                |.

            p
                | Let
                me \Lambda_d  = \{z_Q \in \mathcal F : \disc(Q) = d\}
                | .

            p
                | We need to sum properly to take automorphisms into account.

            definition
                statement: p
                    me \sum{\vphantom{\sum}}^*_{z_Q \in \Lambda_d}
                    | is the sum weighted by #[m \frac 12] if #[m Q = a(x^2+ y^2)] (#[m d= -4]), #[m \frac 13] if #[m Q = a(x^2+ xy+y^2)] (#[m d= -3]).

            p
                | If we want to be fancy we can say the word stack here.

            remark
                p
                    me \sum_{z_Q \in \Lambda_d}{\vphantom{\sum}}^*1 = H(d)
                    | where #[m H(d)] is the Hurwitz class number.


            remark
                p
                    | If #[m d] is fundamental, i.e. a discriminant of some #[m \QQ(\sqrt{d})] then #[m H(d) = h(d)] the regular class number.

        p
            | For the measure on #[m \mathcal F] we take
            me \diff\mu = \frac 3\pi \frac{\diff x \diff y}{y^2}
            |.

        theorem#thm-duke
            title Duke
            statement: p
                | Let #[m f \in \cinf(\HH)], that is #[m \Gamma] invariant and bounded on #[m \mathcal F],  then as #[m d \to \infty] over fundamental discriminants
                me \frac{1}{\# \Lambda_d} \sum_{z\in \Lambda_d}{\vphantom{\sum}}^* f(z) \to \iint_{\mathcal F} f\diff \mu
                | .

        p
            | Equidistribution implies density, but is so much more, for example we cannot have dense points but which happen to cluster towards some line for example.

    subsection#subsec-equidist-basics
        title Basics

        aside: p Lecture 2 11/9/2018

        p
            | Question: Let #[m \alpha \in \RR] and consider #[m \{ \alpha n \}] where #[m \{ x \} = x \pmod 1] so #[m \left\{\frac32\right\} = \frac 12].
            | How are these distributed?

        example
            statement: p
                | If #[m \alpha = \frac 27] then we have #[m \{ \{\alpha n \} : n \in \NN\}  = \{\frac i7 : i \in \{0,\ldots, 6\}\}] and in fact it hits each evenly.


        example
            statement: p
                | If #[m \alpha = \sqrt 2] so #[m \{\alpha\}  \approx 0.4142?...] #[m \{\alpha2\}  \approx 0.8284?...] #[m \{\alpha3\}  \approx 0.24264...] #[m \{\alpha4\}  \approx 0.656854..].
                | These spread out densely, but there is a difference between density and equidistribution.
                | In this example, equidistribution says that the proportion of time the sequence spends in each interval #[m (a,b)] is #[m b -a].

        p
            | So questions are: is #[m \{n\alpha\}] dense?
        p
            | Is #[m \{n \alpha\}] uniformly distributed (equidistributed with respect to the standard measure)?
        p
            | The answer to both questions is yes.

        theorem
            title Kronecker
            statement: p
                | Let #[m \alpha \in \RR\smallsetminus \QQ] then #[m \{n \alpha\}] is dense in #[m \lb 0,1)].

        paragraphs
            title Digression (Diophantine approximation)

            p
                | This is a very tough area of number theory, not so many definitive results here.

            theorem
                title Dirichlet
                statement: p
                    | Let #[m \alpha \in \RR,N\in \ZZ_{\gt 0}] then there exists #[m p,q] with #[m q \gt 0].
                    me \left| q\alpha - p \right| \lt \frac 1N
                    | .
                proof: p
                    | (Pidgeonhole) divide #[m \lb 0, 1)] into even #[m N] subintervals of width #[m \frac 1N], consider
                    me \alpha_0 = 0,\alpha_1 = \left\{ \alpha 1\right\}, \alpha_2 = \left\{ \alpha 2\right\}, \ldots\in \lb 0,1)
                    | as soon as we get to #[m \alpha_N] we must have two in one subinterval say #[m |\alpha_{n_1} - \alpha_{n_2}| \lt \frac 1N].
                    | So there exists #[m p_{n_1}, p_{n_2}] such that
                    me | n_1 \alpha - k_{n_1} - (n_2\alpha - k_{n_2}) | \lt \frac1N
                    me | (n_1  - n_2)\alpha -( k_{n_1} - k_{n_2}) | \lt \frac1N
                    | .

            corollary
                statement: p
                    | Let #[m \alpha \in \RR\smallsetminus \QQ] then there exists infinitely many coprime #[m p,q] with #[m q \gt 0] satisfying
                    me \left| \alpha - \frac pq \right| \lt \frac {1}{q^2}
                    | .
                proof: p Exercise.

            p
                | This is very strong, Roth's theorem tells us that even #[m q^{2+\epsilon}] here is enough to force finiteness.

            note: p
                | #[m \alpha \not \in \QQ] is necessary! Otherwise
                me \left | \frac{p_0}{q_0} - \frac pq \right| = \left | \frac{p_0q - pq_0}{qq_0} \right| \ge \frac{\left | p_0q - pq_0 \right|}{\max \left\{q^2 ,q_0^2 \right\}}
                | so choose #[m q \gt q_0] implies #[m \frac {p_0}{q_0} = \frac pq].

            p
                | One can do better:

            theorem
                title Hurwitz
                statement: p
                    | Let #[m \alpha \in \RR\smallsetminus \QQ]
                    me \left| \alpha - \frac pq \right| \lt \frac {1}{\sqrt 5q^2}
                    | then there exists infinitely many coprime #[m p,q] with #[m q \gt 0] satisfying.

            note: p
                | #[m \sqrt 5] is the best possible without further restriction on #[m \alpha].

            example: statement: p
                | If #[m \alpha = \frac{1- \sqrt 5}{2}] then
                me \left| \alpha - \frac pq \right| \lt \frac {1}{Aq^2}
                | has only finitely many solutions for #[m A \gt \sqrt 5].

            p
                | What if we allow further restriction?

            theorem
                title Liouville
                statement: p
                    | Let #[m \alpha \in \RR] algebraic of degree #[m n \gt 1].
                    | Then there exists #[m A \gt 0] such that for all #[m p,q] with #[m g \gt 0]
                    me \left| \alpha - \frac pq \right| \gt \frac {A}{q^n}
                    | .
                proof: p
                    | Let #[m f \in \ZZ\lb x \rb] be the minimal polynomial of #[m \alpha].
                    | Gauss's lemma implies that #[m f] is irreducible over #[m \QQ] so
                    me q^n f\left(\frac pq\right)  \in \ZZ \smallsetminus\{0\}\,\forall \frac pq\in \QQ
                    | .
                    | The mean value theorem says that there exists #[m x_0 \in \lb \alpha , p/q )] s.t.
                    me \frac{f(p/q) - \cancelto{0}{f(\alpha)}}{p/q - \alpha} = f'(x_0)
                    | so
                    me \frac{q^nf(p/q) }{q^n f'(x_0)} = |p/q - \alpha|
                    | , notice how #[m n] appears here.

            p
                | This theme of using some calculus is repeated across diophantine analysis.

            remark
                p
                    ul
                        li
                            | Thue: can replace #[m n] with #[m (\deg(\alpha) + 2)/2]
                            | (This already has implications to integral solutions of degree #[m \ge 3] polynomials #[m f \in \ZZ\lb x \rb], e.g. elliptic curves with bounded integral discriminant)
                        li
                            | Roth (#[m \sim] 1958): for all #[m \epsilon \gt 0 ], there are only finitely many #[m p/q] satisfying
                            me | \alpha - \frac pq| \lt  \frac{1}{q^{2+\epsilon}}
                            | .

        paragraphs
            title Back to equidistribution

            p
                | #[m a_n =  \left\{n \alpha\right\} , \left\{a_n\right\}_{n=1}^\infty].

            theorem
                title Kronecker
                statement: p
                    | #[m a_n] is dense in #[m \lb 0,1)] if #[m \alpha \not \in \QQ].
                proof: p
                    | Will show for any #[m x \in \lb 0,1)] there exists
                    me \left\{ a_{n_j}\right\}_{j=1}^\infty\text{ s.t. } a_{n_j} \to x
                    | .
                    | Notation #[m \| x\|] means the distance to the nearest integer.

                    | Dirichlet implies that infinitely many #[m p/q] have #[m \alpha - p/q| \lt 1/q^2].
                    // TODO xref
                    | Given #[m \epsilon \gt 0] let  #[m q] be such that
                    me | \alpha - \frac pq |  \lt \frac{1}{q^2} \implies | q\alpha - p| \lt \frac 1q
                    me \frac 1q \lt \epsilon
                    | Choose #[m j] such that #[m j (\alpha q- p)] is within #[m 1/q] of #[m x] (why?).
                    | So
                    me \| j(\alpha q - p ) -x\| \lt \frac 1q \lt \epsilon
                    |. (Fill in the gaps here).

            p
                | Now let's define what is means to be uniformly distributed.

            definition#def-unif-dist
                title Uniformly distributed sequence
                statement: p
                    | #[m a_1, a_2, \ldots] is called #[term uniformly distributed] if for all #[m (b,c) \subseteq \lb 0,1)]
                    me \#\left\{ n \le N : \left\{ a_n\right\} \in (b,c) \right\} \sim N(c-b)
                    | or
                    me \lim_{N \to \infty} \frac{\#\left\{ n \le N : \left\{ a_n\right\} \in (b,c) \right\}}{N} = c-b
                    | .

            p
                | Uniformly distributed or not?
            p
                | When #[m \alpha \in \RR \smallsetminus \QQ]:  #[m \{ n\alpha \}], #[m \{ n^2\alpha \}], #[m \{ (3n^2 + 2n + 1)\alpha \}] #[m \{ (\sqrt 5 n^3  + 2n - (\zeta_{10} + \bar \zeta_{10}))\alpha \}] all are.
            p
                | #[m  \{ n! e \}],  #[m \{\log(n)\}] and #[m \{ \log (p_n)\}] are not.

        aside: p Lecture 3 13/9/2018

        example
            title Several
            p
                ol
                    li
                        | #[m \alpha\in \RR\smallsetminus\QQ,\,a_n = \{n\alpha\}]. Yes
                    li
                        | #[m \alpha\in \RR\smallsetminus\QQ,\,a_n = \{n^2\alpha\}]. Yes
                    li
                        | #[m a_n = \{\log(n)\}]. No
                    li
                        | #[m a_n = \{n! e\}]. No (not dense).
                    li
                        | #[m \{ \log (p_n)\}]. No.
                    li
                        | #[m a_n = \{\sqrt{n}\}]. Yes.
                    li
                        | #[m a_n = \{e^n\}]. ?
                    li
                        | #[m a_n = \{\log n!\}]. Yes ?
                    li
                        | #[m a_n = \{\log \log n!\}]. No

            p
                | To begin let's show #[m a_n = \{n!e\}] is not equidistributed as it has only one limit point #[m 0].
                me e = \sum_{n=1}^\infty \frac{1}{n!}
                | so #[m n!e \in \ZZ + \frac{1}{n+1} + \frac{(n+1)(n+2)} + \cdots \le \frac{e}{n+1} \to 0], as #[m n\to \infty].
                | So its not dense, hence certainly not equidistributed.

        theorem
            statement: p
                | The sequence #[m a_n = \{ n\alpha\}] is equidistributed.
            proof
                p
                    | Let #[m \epsilon\gt 0], choose #[m M \gt 0] such that #[m \frac1M\lt \epsilon], furthermore choose a #[m \delta \lt \frac1M].
                    | Dirichlet implies there exists #[m m \in \ZZ] s.t. #[m \| m\alpha\| = \delta].
                    me  0\lt \delta \lt \frac1M \lt\epsilon
                    | recall #[m \| x\|] is the distance to the nearest integer.

                    | Consider the set #[m S_i = \left\{ \{n \alpha\} : n \lt N,\,n \equiv i \pmod m\right\}] then
                    me S = \{ \{n \alpha\} : n\lt N \}  = \bigsqcup_{i=1}^m S_i
                    | moreover,
                    me S_i =  \{\{ km\alpha + i\alpha\}  : 0 \le k \le N_i\}
                    | where
                    me N_i = \frac Nm + O(1)
                    | (why is the #[m O(1)] here?).
                    | We can rewrite these #[m S_i] as follows:
                    me S_i = \{ \delta k + \gamma_i \pmod 1 : 0 \le k \le N_i\}
                    | where
                    me.
                        \begin{cases} i\alpha \pmod 1 \amp \text{ if } \delta  = \{ m\alpha \} \\
                                      i\alpha - \delta (N_i + 1)\pmod 1 \amp \text{ if } \delta  = 1 - \{ m\alpha \} \\
                        \end{cases}

                    | replace #[m k] by #[m N_i  + 1-k ].
                p
                    | Now #[m 0 \le \gamma \lt 1] and let
                    me K_i = \lfloor \delta N_i + \gamma_i \rfloor
                    me \# \{ k \lt N_i : \{ \delta k + \gamma_i \} \in \lb b,c\rb \} = \sum_{j=0}^{K_i} \# \{k \le  N_i : \delta k + \gamma  \in [j+b,j+c] \}
                    me = (K_i + O(1)) \left(\frac{c-b}{\delta} + O(1) \right)
                    me N_i(c-b) + O\left( \frac {c-b}{\delta} + \delta N_i + 1 \right)
                    | so
                    me S =  \bigsqcup_{i=1}^m S_i
                    me \# S = N(c-b) + O\left( \frac M\delta + \delta N \right)
                    | (check!).
                    | Finally choose #[m N \gt \frac{M}{\delta^2}].
                    | So that
                    me \frac{M}{\delta} + \delta N \lt \epsilon N
                    | .
                    | Which implies
                    me \# \{ n \lt N : \{n\alpha \} \in [b,c] \}  =\#S =N(c-b) + \epsilon N
                    |.

        p
            | We followed our nose essentially, but we needed to put ourselves in a favourable position so that we can get a good handle on the error.

        example
            title 10

            statement: p
                | Consider the sequence
                me b_{m,i} = \frac i m
                | and define
                me a_{\binom{m}{2} + i } = b_{m,i}
                | so that
                me b_{m,i}
                me 0,1
                me 0,\frac 12 , 1
                me 0,\frac 13 ,\frac 23, 1
                me 0,\frac 14 ,\frac 24,\frac 34, 1
                me a_m = 0,1, 0,\frac 12 , 1, 0,\frac 13 ,\frac 23, 1, 0,\frac 14 ,\frac 24,\frac 34, 1
                | this is uniformly distributed!

        exercise
            statement: p
                | Prove this (in a similar way to before).

        proposition
            statement: p
                ol
                    li
                        | Any sequence has a rearrangement that is not uniformly distributed.
                    li
                        | Any dense sequence has a rearrangement that is uniformly distributed.
            proof: p
                ol
                    li
                        | If not sense we are done already.
                        | Otherwise let #[m I_1 = \lb 0, \frac 12) ,I_2 = \lb\frac 12, 1\rb]
                        | Let #[m X = \{a_n \in I_1\}, Y = \{a_n \in I_2\}], so both sets are infinite.
                        | Let #[m b_n  = x_1, \ldots, x_{10^{10}}, y_1, x_{10^{10} + 1}, \ldots, x_{20^{20}},\ldots]
                        | so #[m \# \{n:b_n  \in \lb4/5,1\rb \}  \sim \frac{N}{10^{10}}].
                    li
                        | If #[m a_n] is dense then, let
                        me b_{n,i} = a_m \text{ s.t. } \frac{i-1}{n} \lt a_m \lt \frac in
                        | by the example above this is equidistributed.

        p
            | What can we say about the space of uniformly distributed sequences?
            | Is it closed under addition? No (#[m a_n = -b_n]).
            | #[m \{k a_n\}] neither (#[m a_n = \alpha n,\,\frac1\alpha a_n = n]).
            | #[m a_nb_n] doesn't work either, but if #[m b_n] converges then #[m a_nb_n] is uniformly distributed.

    subsection
        title Weyl's criterion (1916)

        aside: p Lecture 4 18/9/2018
        theorem#thm-weyl-criterion
            title Weyl's criterion
            statement: p
                | #[m \{a_n\}_{n=1}^\infty \in \RR] then TFAE:
                ol
                    li
                        | #[m \{a_n\}_{n=1}^\infty] is uniformly distributed mod #[m 1].

                    li
                        | #[m \forall f \in C(\lb 0,1\rb)]
                        me \lim_{N\to \infty} \frac 1N \sum_{n=1}^N f(\{a_n\}) = \int _0^1 f \diff x
                        | .
                    li
                        me \lim_{N\to \infty} \frac 1N \sum_{n=1}^N e(ma_n) = \delta_m,\, \forall m \in \ZZ
                | where #[m e(x) = e^{2\pi i x}],
                me \delta_m = \begin{cases} 0 \amp m \ne 0 \\ 1 \amp m = 0 \end{cases}
                | , collectively this is known as #[term Weyl's criterion].
            proof
                proofcase
                    title  #[m 1.\implies 2.]
                    p
                        | #[m 1.] means #[m 2.] is true for the characteristic function of #[m \lb b,c\rb], hence true for step functions (because everything is linear).
                    p
                        | Recall that any #[m f \in C\lb 0,1\rb)] is the uniform limit of such functions.
                    p
                        | Exercise: Choose one that is #[m \epsilon] close to #[m f] and finish the proof.

                proofcase
                    title  #[m 2.\implies 1.]
                    p
                        | Find #[m f_1,f_2 \in C(\lb 0,1 \rb)] such that #[m f_1(x) \le \chi_{(b,c)}(x) \le f_2(x)] s.t.
                        me \int f_1 - \chi_{(b,c)}) \le \epsilon
                        | Exercise, finish this proof.
                proofcase
                    title  #[m 2.\implies 3.]
                    p
                        | Obvious.
                proofcase
                    title  #[m 3.\implies 2.]
                    p
                        | Recall Fejér's theorem that #[m f\in C\lb 0,1 \rb)] is the uniform limit of its fourier series.
                        | Pick an #[m n \in \NN] s.t.
                        me f_n(x) - \epsilon \le f(x) \le f_n(x) + \epsilon
                        | .
                    p
                        | Exercise, finish this proof.


        p
            | Using this we can tackle more examples, e.g.:
            ol
                li #[m \{\alpha p_n\}], #[m n]-th primes, #[m \alpha\in \RR\smallsetminus \QQ].
                li #[m \{\sqrt{n}\}]
                li #[m \{\log(n)\}]
                li #[m \{\log(p_n)\}]
                li #[m \{\beta^n\}], #[m \beta \in \RR].
                li #[m \{\alpha a_n\}], #[m a_n \in \ZZ]

    subsection
        title Some applications of Weyl's criterion

        paragraphs
            title Application 1
            p
                | #[m \{n \alpha \}] is uniformly distributed iff #[m \alpha \in \RR\smallsetminus \QQ].
                | Let
                me S_N(h,\alpha) = \sum_{n=0}^N e(h\alpha n)
                |then
                me S_N(h,\alpha) = \frac{e((N+1) h\alpha) - 1}{e(h\alpha)  - 1}
                | .
                | Then #[m e(h\alpha ) - 1 \ne 0] for all #[m h \in \ZZ\smallsetminus \{0\} ] iff #[m \alpha \not \in \QQ] so #[m S_N(h,\alpha ) = O_{h,\alpha}(1) ] iff #[m \alpha \not \in \QQ].
                | So #[m \lim_{N \to \infty} S_N(h,\alpha)  = 0,\,\forall h \ne  0 \iff \alpha\not \in \QQ].
                | And #[m S_N(0,\alpha) = N+1] which implies
                me \lim_{N\to \infty} \frac1N S_N(0,\alpha) = 1
                | so by Weyl's criterion #[m \left\{ n\alpha \right\}] is uniformly distributed if #[m \alpha \not \in \QQ].

        paragraphs
            title Digression

            theorem
                title Vinogradov 1937
                statement: p
                    | #[m \{ \alpha p_n\} ] is uniformly distributed iff #[m \alpha \not \in \QQ].
            p
                | He actually showed weak Goldbach conjecture, Every (sufficiently large) #[em odd] integer is a sum of 3 primes.
                | No bound by Vinogradov, Borozdin gave a large bound, Helfgott brought it down to reality.

        paragraphs
            title Application 2
            p
                me \{\beta^n \}
            theorem
                title Koksma 1935
                statement: p
                    | For almost every (Lebesgue) #[m \beta\in \RR_{\gt 1}], #[m \left\{\beta^n\right\}] is equidistributed.
            p
                | Koksma was a Dutch student of Van der Corput.

            theorem
                title Weyl
                statement: p
                    | Let #[m |a_n| \to \infty] be a sequence of distinct integers, the set of #[m \alpha \in \RR] such that #[m \alpha a_n] is not uniformly distributed has Lebesgue measure 0.

        paragraphs
            title Application 3
            p
                me \{\log(n) \}
                | is not equidistributed.
            exercise
                statement: p
                    | Prove this.
                    | Hint : assume it was
                    me \# \{ n \lt 1001 N : \} =\# \{ n \lt 1000N : \} + \# \{1000N \le n \le 1001 N : \}
                    | then
                    me \log(n) - \log(100N + n_1) = \log(1000N) + \log (1+ n_1/1000N)
                    // TODO this is fubar

        paragraphs
            title Application 4
            p
                me \{\sqrt{n} \}
            p
                | Before this, lets introduce
            definition#def-discrepancy
                title Discrepancy
                statement: p
                    | Let #[m a_n \in \lb0,1)] be a sequence and #[m N\in \ZZ_{\ge 0}] we define
                    me D_N = \sup_{0\le b\le c \le 1}\left\{ \left| \frac{\# \{n \lt N : a_n \in [b,c ]\}}{N}  - (c-b)\right| \right\}
                    | .

            p
                | Some useful lemmas:
            lemma
                statement: p
                    | Let
                    me D_N^*= \sup_{0\le c \le 1}\left\{ \left| \frac{\# \{n \lt N : a_n \in [0,c ]\}}{N}  - c \right|\right\}
                    | then
                    me D_N^* \to 0 \iff D_N \to 0
                    | .
                proof
                    p
                        | Exercise (hint squeeze).

            lemma
                statement: p
                    | #[m a_n] is uniformly distributed #[m  \iff  D_N \to 0 \iff D_N^* \to 0].
                proof
                    p
                        | Ommitted/exercise, 2.1.1 of Kuipers and Niederreiter.

            p
                | For #[m \sqrt{n}] now.
                me S_N(c) = \# \{ n \le N : 0 \le \{ \sqrt n \} \le c\}
                | .
            note
                p
                    | If #[m d = \lfloor \sqrt{n} \rfloor] then
                    me \sqrt n =  d + \{ \sqrt n \}
                    | and #[m d \le \sqrt n \le d+ 1] and #[m \#\{ n :  d \le \sqrt  n \le d+ 1\} = 2d+ 2].
            p
                | Similarly
                me  \# \{ n : d \le \sqrt n \le d + \alpha \} = 2\alpha d + \alpha^2 + 1
                | then
                me S_N(\alpha) = \sum_{j=0}^{\lfloor \sqrt N \rfloor} \# \{ n : j + \alpha \le \sqrt n\le j + \alpha\}
                me             = \sum_{j=0}^{\lfloor \sqrt N \rfloor} 2\alpha d + \alpha^2 + O(1)
                me = 2\alpha  \frac{ \lfloor \sqrt N \rfloor (\lfloor \sqrt N \rfloor + 1)}{2} + O(\sqrt N) = \alpha N + O(\sqrt N)
                | so
                me D_N^* = \sum_{0\le \alpha \le  1} \left\{ \left| \frac{S_N(\alpha)}{N} -\alpha \right| \right\} = \sup_{0\le \alpha \le 1 } O_\alpha (1/\sqrt{N}) = O(1/\sqrt N)
                | .
            exercise
                statement: p
                    | Make the dependence on #[m \alpha ] explicit and make the proof rigorous.



        paragraphs
            title Application 5
            aside: p Lecture 5 20/9/2018
            proposition
                statement: p
                    me \{\log(p_n) \}
                    | is not equidistributed.
                proof
                    p
                        | Assume otherwise, let #[m k \in \ZZ_{\gt0}].
                        me I_k = \min\{ n : p_n \gt e^k \}
                        me I_{k-1/2} = \min\{ n : p_n \gt e^{k-1/2} \}
                        me \chi_{\lb 0,1/2)} = \text{char. fn. of }\lb 0, 1/2)
                        | .
                    p
                        | Consider
                        me S_k = \sum_{n \lt I_k} \chi_{\lb 0,1/2)} ( \{\log (p_n) \} )
                        me S_{k-1/2} = \sum_{n \lt I_{k-1/2}} \chi_{\lb 0,1/2\rb} ( \{\log (p_n) \} )
                    p
                        | Note that #[m S_k = S_{k-1/2}].
                    p
                        | If uniformly distributed
                        me \lim_{k\to \infty} \frac{S_k}{I_k} = \lim_{k\to \infty} \frac{S_{k-1/2}}{I_{k-1/2}} = L
                        me L\gt 0 \implies I_{k}/I_{k-1/2} \to 1
                        |.
                    p
                        | But the prime number theorem says
                        me \pi(N)  =\# \{ p \lt N \}  \sim \frac{N}{\log N}
                        | so
                        me I_{k}/I_{k-1/2} \sim \sqrt e \ne 1
                        | so #[m L=0] but this cannot happen either.
                        me S_{k-1/2} \ge \pi(e^{k-1/2}) - \pi (e^{k-1})
                        me           \ge e^{k-1} \frac{\sqrt e - 1}k \gt 0
                        | .

    subsection
        title Weyl differencing and the Van der Corput inequality


        theorem
            title Weyl
            statement: p
                | Let
                me P(x) = a_n x^n + a_{n-1} x^{n-1} + \cdots + a_0 \in \RR\lb x\rb
                | then
                me \{P(n)\}
                | is uniformly distributed mod 1 iff there exists #[m n_0 \in \{ 1,\ldots, n\}] s.t. #[m a_{n_0} \not \in \QQ].

        lemma#lem-weyl-diff
            title Weyl differencing
            statement: p
                | Let #[m y_n  \in \CC], such that #[m y_n = 0] if #[m n \lt 1] or #[m n \gt N] then we would like to bound
                me \sum_m \sum_n y_n \overline y_m  = \sum_{m,n=1}^N = S_N \overline S_N = |S_N|^2
                | , #[term Weyl differencing] gives
                me \sum_{m=1}^N \sum_{n=1}^N y_n \overline y_m  = \underbrace{\sum_n |y_n| ^2}_{\text{diagonal contribution}}  + \underbrace{2 \Re \left( \sum_{n=1}^{N-1} \sum_{m=1}^{N-n} y_{n+m} \overline y_m \right) }_{\text{off diagonal terms}}
                | .
            proof
                p
                    | Idea: Use the transformation
                    me n \mapsto n+ m
                    me m \mapsto m
                    me.
                        \begin{pmatrix} n\\ m\end{pmatrix}
                        \begin{pmatrix} 1\amp 1 \\ 0 \amp 1\end{pmatrix}
                    | switch orders
                figure
                    caption Regions
                    image: latex-image.
                        <![CDATA[
                        \begin{tikzpicture}
                            \draw[thick] (-1,0) -- (5,0);
                            \draw[thick] (0,-1) -- (0,5);
                            \filldraw[fill=gray!20!white, draw=gray!20!black] (1,1) -- (1,4) -- (4,4) -- (4,1) -- (1,1);
                            \draw[thick] (7,0) -- (12,0);
                            \draw[thick] (8,-1) -- (8,5);
                            \filldraw[fill=gray!20!white, draw=gray!20!black] (8,1) -- (5,4) -- (8,4) -- (11,1) -- (8,1);
                        \end{tikzpicture}
                        ]]>
                p
                    me \sum_m \sum_n y_n \overline y_m =  \sum_m \sum_n y_{n+m} \overline y_m
                    | Note: if #[m n \ge 0] then #[m m  = 1 ,\ldots, N-n],  #[m n = 0, 1,\ldots, N-1].
                    | If #[m n \lt 0] then
                    me m = 1-n, \ldots, N
                    me n = 1-N, \ldots, -1
                    me \sum_{m=1}^N |y_m|^2 + \sum_{n=1}^{N-1} \sum_{m=1}^{N-n} y_{n+m}\overline y_m +  \sum_{n = -N+1}^{-1} \sum_{m= 1-n}^N y_{m+n} \overline y_m
                    me = \sum_{m=1}^N |y_m| ^2  + 2 \Re \left( \sum_{n=1}^{N-1} \sum _{m=1}^{N-n} y_{n+m} \overline y_m \right)


        theorem
            title Weyl
            statement: p
                | Let #[m |x_n| \to \infty] be a sequence of distinct integers, the set of #[m \alpha \in \RR] such that #[m \alpha x_n] is not uniformly distributed has Lebesgue measure 0.
            proof
                p
                    | Let #[m \alpha \in  \lb 0,1)], let #[m h \in \ZZ \smallsetminus \{ 0 \}]
                    me S_h(N,\alpha) = \frac 1N \sum_{n=1}^N e(hx_n\alpha)
                    | the trick is now to bound #[m |S_h(N,\alpha)|^2]
                    me N^2|S_h(N,\alpha)|^2 = \sum_{n=1}^N 1 +2\Re \left( \sum_{n=1}^{N-1} \sum_{m=1}^{N-n} e(h(x_{n+m} - x_m) \alpha) \right)
                    | so
                    me \int_0^1 |S_h(N,\alpha)|^2 \diff \alpha = \frac 1N
                    | .
                p
                    | Recall Fatou's lemma:
                    | Let #[m f_n  \gt 0] be  sequence of positive measurable functions, then if
                    me f(x) = \liminf f_n(x)
                    | we have
                    me \int f \le \liminf \int f_n
                    | .
                p
                    | Take
                    me f_n(\alpha) = \sum_{N=1}^{n} | S_h (N^2,\alpha)|^2
                    | Fatou implies
                    me  \int_0^1 \sum_{n=1}^\infty |S_h(N^2,\alpha)|^2 \diff \alpha \le \sum_{N=1}^\infty \int_0^1 |S_h(N^2,\alpha)|^2\diff \alpha \lt \infty
                    | so
                    me \sum_{N=1}^\infty  |S_h(N^2 ,\alpha)|^2
                    | is finite for almost all #[m \alpha] and for any #[m h \ne 0].
                    | Then by Weyl's criterion we are done.

        lemma
            title Van der Corput
            statement: p
                | Let #[m y_n  \in \CC], such that #[m y_n = 0] if #[m n \lt 1] or #[m n \gt N] then
                me \forall H \in \ZZ_{\gt 0 }
                | we have
                me \left| \sum_{n=1}^N y_n \right|^2 \le \frac{N+ H} {H+1 } \sum_{n=1}^N |y_n|^2 + \frac{2(N+H)}{H+1} \sum_{h=1}^H \left(1 - \frac h{H+1} \right) \left| \sum_{n=1}^{N-h} y_{n+h} \overline y_n\right|
                | .
            proof
                aside: p Lecture 6 25/9/2018
                p
                    | Consider
                    me (H+ 1)^2 \left| \sum_{n=1}^N y_n\right|^2
                    | then
                    me (H+ 1)^2 \left| \sum_{n=1}^N y_n\right|^2 = \left| \sum_{h= 0  }^H \sum _{n=1}^N y+n\right |^2
                    me = \left|  \sum_{h= 0}^H \sum _{n\in \ZZ} y_{n+h}\right|^2
                    men#eqn-vandercorput = \left|  \sum _{n\in \ZZ}\sum_{h= 0}^H  y_{n+h}\right|^2
                    | note #[m n]-sum is nonzero for at most #[m N+H] terms #[m 1-H \le n \le N] then Cauchy-Schwarz implies
                    me #[xref(ref="eqn-vandercorput")/] \le (N+ H) \sum_n  \left| \sum_{h=0}^H y_{n-h} \right|^2
                    men#eqn-vandercorput2 = (N+H) \sum_n \sum_{h_1 = 0}^H \sum_{h_2 = 0}^H  y_{n+h_1} \overline{y_{n + h_2}}
                    | let #[m m = n + h_2],  #[m l = h_1 - h_2]. Then
                    me #[xref(ref="eqn-vandercorput2")/]  = (N+H) \sum_{-H \le l \le H} \sum_m \overline y_m y_{m-l} \underbrace{\left( \sum_{0\le h_1, h_2 \le H} 1 \right)}_{= I(H,l)}
                    | note #[m I(H,l) = H+1 - |l|], so
                    me #[xref(ref="eqn-vandercorput2")/]  = (N+H) \sum_{-H \le l \le H} H +  1 - |l | \sum_m \overline y_m y_{m-l}
                    | then if #[m l = 0] we get the first term of the statement, #[m l \ne 0] the other.
                    // TODO this is broken

        p
            | What is the difference between this and Weyl differencing?
            | When #[m H] is large, not so much, but we can take #[m H] small now, shifting the weighting around.
            | We change the balance to make one part shorter and the other longer.

        theorem#thm-van-der-corput-diff
            title Van der Corput differencing
            statement: p
                | If for each #[m h \in \ZZ_{\ge 1}] the sequence #[m b_h(n) = a_{n+h} - a_n] then so is #[m a_n].
            proof
                p
                    | We'll use Weyl's criterion and the van der Corput lemma.
                    | Fix, #[m N \in \ZZ_{\ge1}] a #[m H\le N].
                    | Then for any #[m k \in \ZZ\smallsetminus\{0\}]
                    me \left| \sum e( ka_n) \right|^2   \le \frac{ N+H}{H+ 1} N + 2 \frac{ N+H}{H+ 1}  \sum \left(1 - \frac h{H+1} \right) \left| \sum_{n=1}^{N-h} e(b_h(n)k) \right|
                    me \implies \lim_{N \to \infty} \frac{1}{N^2} \left| \sum_{n=1}^N e(ka_n)\right|^2 \le \frac1{H+1}
                    | since #[m H] is arbitrary
                    me \lim_{N \to \infty} \frac{1}{N^2} \left| \sum_{n=1}^N e(ka_n)\right|^2  = 0
                    | .

        proof
            title Proof of Weyl's theorem
            p
                | Let #[m \deg P = d] then, for #[m d = 1] we are done by Weyl's criterion, for #[m d \le D] use van der Corput differencing.
                | Note that  for fixed #[m h], #[m P(n+h) -P(n)] is of lower degree.

    subsection
        title A different perspective (Ergodic)
        // https://personalpages.manchester.ac.uk/staff/charles.walkden/ergodic-theory/ergodic_theory.pdf

        p
            | Furstenberg (1981 book) gives a different proof that #[m \{n ^2 \alpha\}] is uniformly distributed.
            //  Furstenberg, Harry. Recurrence in ergodic theory and combinatorial number theory. Vol. 10. Princeton University Press, 1981.
        paragraphs
            title Ergodic theory 101

            definition#def-ergodic-measure
                title Ergodic measures
                statement: p
                    | Let #[m X] be a locally compact space and #[m H] a non-compact group, #[m H \acts X].
                    | #[m \mu] a probability measure on #[m X],  #[m H]-invariant.
                    | We say that #[m \mu] is an #[term ergodic measure] if any of the following equivalent conditions hold
                    ol
                        li
                            | #[m A \subseteq X] and #[m A ] is #[m H]-invariant (#[m hA = A] for all #[m h \in H]).
                            | Then
                            me \mu(A) = 1 \text{ or } \mu (A) = 0
                            | .
                        li
                            | For #[m f] measurable #[m \mu] almost everywhere #[m H]-invariant
                            me f(hx) = f(x)
                            | for almost all #[m x] then #[m f] is constant #[m \mu] almost everywhere.
                        li
                            | #[m \mu] is an extreme point on the convex set of #[m H]-invariant probability measures.


            definition#def-uniq-ergodic
                title Uniquely ergodic actions
                statement: p
                    | An action of a group #[m H] on a locally compact space #[m X] is #[term uniquely ergodic] if  there is only one invariant probability measure on #[m X].


            example
                statement: p
                    | #[m x\mapsto 5x], or #[m x\mapsto \sqrt2 + x] on #[m T^1] are ergodic, let's show that #[m x\mapsto \sqrt 2 + x] is uniquely ergodic.

            lemma
                statement: p
                    | Let #[m \alpha \in \RR\smallsetminus \QQ] then #[m T_\alpha \colon x  \to x+ \alpha] is uniquely ergodic.
                proof: p
                    | Let #[m \mu] be an invariant probability measure on #[m \lb 0,1\rb] the #[m n]th Fourier coefficient
                    me \hat \mu(n) =  \int e(nx) \diff \mu (x) = e(n\alpha) \int e(nx) \diff \mu (x)
                    | so #[m \hat \mu(n) = \delta(n)].

            example: statement: p
                | For #[m x\mapsto 5x] #[m f = \sum a_ne(nx) = \sum a_n e(5nx)] so #[m a_n = a_{5n}]
                me \infty \gt \| f\|^2 = \|a_n\|^2  \implies a_n = 0 \forall  n \ne 0
                me \implies f \equiv C \text{ a.e.}

            //p
                me T_\alpha \colon T^2 \to T^2
                me (x,y) \mapsto (x+\alpha, 2x+y + \alpha)
                me T^n_\alpha(x,y) = (x+n\alpha, y+ 2nx + n^2 \alpha)
                me (n\alpha, n^2 \alpha)

            aside: p Lecture 7 2/10/2018

            definition#def-equidist
                title Equidistribution
                statement: p
                    | A sequence of probability measures #[m \mu_n] on a locally compact space #[m X] is called #[m \mu]-#[term equidistributed] if they converge to #[m \mu] in the weak #[m \ast] topology.
                    | I.e.
                    me \forall f \in C_c(X),\, \int f\diff \mu_n \to \int f \diff \mu
                    | .

            remark
                p
                    | If we have a sequence #[m a_n] these define a sequence of measures
                    me \mu_N = \frac 1N \sum_{n \le N} \delta( x - a_n)
                    | if these are equidistributed then
                    me \lim_{N \to \infty} \frac 1 N \sum_{n=1}^N f(a_n) = \int_X f(x) \diff \mu (x)
                    |.

            theorem
                title Birkhoff ergodic theorem
                statement: p
                    | #[m (X, B, \mu, T)] a measure preserving system (as in the definition of ergodic) with #[m \mu] a probability measure.
                    | Then for any #[m f \in L^1(X, \mu)]
                    me \lim_{n\to  \infty} \frac 1n \sum_{i=0}^{n-1} f\circ T^i(x) = \bar f (x)
                    | for some #[m \bar f \in L^1( X,\mu)] moreover
                    me \int \bar f \diff \mu = \int f \diff \mu
                    | and if #[m T] is ergodic then #[m \bar f (x) = \int f \diff \mu] almost everywhere.
            remark
                p
                    | This does not help us!
                p
                    | But the following does:
            theorem
                statement: p
                    | If #[m X] is compact and #[m H \cong \RR] is uniquely ergodic with the unique #[m H]-invariant measure #[m \mu] then the statement of Birkhoff holds for every #[m x \in X].
                proof
                    title Proof (sketch)
                    p
                        | For any  #[m x] construct
                        me \mu_L = \frac 1 L \int_0^L h_t x \diff t
                        me \mu_L \to \mu, \, L\to \infty
                        | in the weak #[m \ast] sense.

            remark
                title Funny side remark (Benford's law)
                p
                    | First digit of a set of observations are usually 1 (roughly 30#[percent/]).
                p
                    | Why?
                    | Assumption, the process follows a power law, if #[m b^n] is the first digit of this is
                    me \log_{10} b^n = n \log_{10} b
                    | this is #[m k] iff #[m n \log_{10} b \in \lb \log_{10} k , \log_{10} k + 1 \rb].
                    | If these are equidistributed then the probability of #[m k] is
                    me \int_{\log_{10} k}^{\log_{10} k+1} 1 \diff x = \log(1 + 1/k)
                    | .

            theorem
                statement: p
                    | #[m \{n ^2 \alpha\} ] is equidistributed for #[m \alpha \in \RR\smallsetminus \QQ].
                proof
                    p Furstenberg
                    p
                        ol
                            li
                                | Construct a suitable dynamical system on #[m T^2] (2-torus), for which a specific orbit gives the sequence #[m \{n^2 \alpha \}].
                            li
                                | Will show that this is uniquely ergodic.

                        me T \colon T^2 \to T^2
                        me (x,y) \mapsto( x+\alpha, y + 2x + \alpha)
                        me T^n_\alpha(x,y) = (x+n\alpha, y+ 2nx + n^2 \alpha)
                        | in particular the orbit of #[m (0,0)] is
                        me T^n(0,0) = (n\alpha, n^2 \alpha)
                        | so if we show that #[m T^n(0,0)] is equidistributed we are done.
                    p
                        | So we show that #[m X,T] is uniquely ergodic.
                    p
                        ol
                            li Lebesgue is ergodic.
                            li Only ergodic measure

                        ol
                            li
                                me f\in L^2 (T^2, \diff m)
                                | #[m T]-invariant
                                me f(x,y) = \sum_{m,n} a_{m,n} e(mx+ ny)
                                | #[m T]-invariance implies #[m a_{m,n} = e((m+n)\alpha) a_{m+2n,n}]
                                | in particular
                                me |a_{m,n} | = |a_{m+2n,n}|
                                | so
                                me a_{m,n} = 0
                                | if #[m n \ne 0].
                                | By Riemann-Lebesgue lemma.
                                | So for #[m n=  0]
                                me \sum a_{m,0} e(mx)
                                | #[m T]-invariance implies #[m a_{m,0} = e(m\alpha) a_{m,0}] so #[m a_{m,0} = 0] for all #[m m \ne 0].
                                | So #[m f] is constant almost everywhere.
                            li
                                p We use the following:
                                p Claim:
                                p
                                    | #[m g \colon T^1 \to T^1] measurable, let #[m T_g \colon T^2 \to T^2]
                                    me (x,y) \mapsto (x+\alpha, y+ g(\alpha))
                                    | Then if the Lebesgue measure #[m m] is #[m T_g]-ergodic then it indeed is uniquely ergodic.
                                p
                                    | Proof: exercise.
section#sec-duke
    title Duke's theorem

    paragraphs
        title Recall

        aside: p Lecture 8 4/10/2018
        p
            | #[xref(ref="thm-linnik")/] #[xref(ref="thm-duke")/].
        p
            | We will now prove this, not via Linnik's proof, but via an analogue of Weyl's criterion.
            | Strategy:
            ol
                li
                    | Weyl's criterion  #[m \leadsto] bounding exponential sums.
                li
                    | To bound these sums we will use automorphic methods.
        p
            | We will begin with
            | #[xref(ref="thm-linnik")/].
        p
            | So we will be working on #[m S^2].
            | Recall #[xref(ref="thm-weyl-criterion")/] which was for #[m \lb 0,1)].
            | There we used exponentials, why?
            | Because they are a dense, convenient basis, fourier theory.
        p
            | To replace this on the sphere #[m S^2] we use the #[em spherical harmonics], these are homogeneous harmonic polynomials.
            | Analogous with the #[m S^1] case.
            me \left( \frac{x+iy}{|x+iy|}\right)^m = e(m\theta)
            | the same spherical harmonic construction works for #[m S^n].
        p
            | We will show
            me \frac{1}{\# \Omega_n} \sum_{x\in \Omega_n} P(x) \to 0
            | for #[m \deg P(x)  \gt 0].
            | i.e.
            men#eqn-spherical-harmonic-bd \sum_{\alpha \in \ZZ^3,|\alpha|^2 = n} P\left(\frac\alpha{|\alpha|}\right) = o( r_3(n))
            | where
            me r_3(n) =  \# \{ a^2 + b^2 + c^2 = n: a,b,c\in \ZZ\}
            | .
    paragraphs
        title Connection to automorphic forms
        p
            | #[m \theta] functions, #[m P] spherical harmonics as before.
        definition
            statement: p
                me \theta_P(z) = \sum_{\alpha \in \ZZ^3} P(\alpha) e ( |\alpha|^2 z)
                | for #[m z\in \HH] this converges.
                me \theta_P(z) = \sum_{n=0}^\infty r_3(n,P) e(nz)
                me r_3(n,P) =\sum_{|\alpha|^2 = n} P (\alpha)
                | .
        fact
            statement: p
                ol
                    li
                        | This is a modular form of weight #[m \frac 32 +  \deg P] for #[m \Gamma_0(4)].
                    li
                        | It is a cusp form if #[m \deg P \gt 0].
        observation
            p
                | If #[m \deg P \not  \equiv 0 \pmod 2] this function is #[m 0].
        p
            | To show  #[xref(ref="eqn-spherical-harmonic-bd")/]:
            ol
                li
                    | Show that
                    me r_3(n) \gg_\epsilon n^{1/2 - \epsilon}
                    | (Gauss-Siegel)
                li
                    | Show that
                    me r_3(n,P) \ll_\delta n^{k/2 - 1/4 - \delta}
                    | for some #[m \delta \gt 0].
            | Why?
        p
            me \sum_{|\alpha|^2 = n} P\left( \frac{\alpha}{|\alpha|} \right) = n^{-\deg(P)/2} \sum_{|\alpha|^2 = n} P(\alpha)
            me = n^{-\deg(P)/2} r_3(n,P)
            | note:
            me \frac k2 - \frac14 - \delta = \frac 12 + \frac{\deg(P)}{2} - \delta
            | .
        p
            | So if #[m r_3(n,P) \ll n^{(1+\deg(P))/2 - \delta}] which implies
            me  \sum_{|\alpha|^2 = n} P\left( \frac{\alpha}{|\alpha|} \right) \ll n^{\frac 12 - \delta}
            |.

        p
            |  If we knew a half-integral weight Ramanujan conjecture:
            me f \in S_k(N) ,\, k \in \frac 12 + \ZZ_{\gt 0}
            | for squarefree #[m n]
            me a_f(n) = O(n^{(k-1)/2 +\epsilon})
            |.

    paragraphs
        title Digression (#[m \theta]-functions)

        p
            | Recall:
            | Integral weight modular forms
            me \Gamma = \SL_2(\ZZ) = \Gamma(1)
            me \Gamma_\infty = \left\{ \begin{pmatrix} 1\amp n \\ 0 \amp 1\end{pmatrix} : n \in \ZZ\right\}
            | In general #[m \Gamma] congruence subgroup #[m \Gamma(N) \subseteq \Gamma \subseteq \Gamma(1)] for some #[m N].
            me f\colon \HH \to \CC
            | is called a modular form of weight #[m k] for #[m \Gamma] if #[m f] is holomorphic everywhere, including at the cusps.
            me f(\gamma z) =  (cz+ d)^k f(z) \,\forall \gamma \in \Gamma
            | . If #[m f (z) = \sum _{n=1}^\infty a_nq^n] then #[m f] is cuspidal, the space of such is #[m S_k(\Gamma)] where S stands for the German Spitzenform.
            | Spitze means cusp, kinda like a pointy spit?
        example
            statement: p
                me \Delta(q) = q\prod_{n=1}^\infty (1-q^n)^{24}
                me E_k(z)= \sum_{(c,d) = 1} \frac{1}{(cz +d)^{2k}}

        conjecture
            title Ramanujan (here theorem of Deligne)
            statement: p
                | #[m f\in S_k(\Gamma)]
                me a_n = O_z( n^{(k-1)/2 + \epsilon}) \,\forall \epsilon \gt 0
                | .
        p
            | Classically
            me \widetilde \theta(z) = \sum_{m\in \ZZ} e^{i \pi m^2z}
            | converges absolutely on #[m z\in \HH]
            me \widetilde \theta(z + 2) =\widetilde \theta(z)
            me \widetilde \theta(-1/z ) = \sqrt{-iz} \widetilde \theta(z)
            | in general for #[m \gamma \in \Gamma_0(4)]
            me \widetilde \theta(\gamma z ) = j(\gamma ; z) \widetilde \theta(z)
            | where #[m j(\gamma;  z) = \legendre cd \epsilon_d^{-1} (cz+d)^{1/2}]
            | where #[m \epsilon_d = 1] if #[m d\equiv 1 \pmod 4],  #[m -1] if  #[m d\equiv 3 \pmod 4] sign of Gauss sum.

            | #[m \legendre cd] is  a sibling of Legendre form.

    aside: p Lecture 9 11/10/2018

    p
        | Recall: #[m P] spherical harmonic degree #[m l ].
        | Aim to show:
        me \sum_{|x|^2 = n} P\left(  x \right) = o( r_3(n))
        |where
        me r_3(n) =  \# \{ a^2 + b^2 + c^2 = n: a,b,c\in \ZZ\}
        | .
    p
        | Took
        me \theta(z; P) = \sum_{n\in \ZZ} r(n; P) e(nz)
        | . A modular form of weight #[m 3/2 + l] for #[m \Gamma_0 (4)].
        | Cusp form if #[m l \gt 0].
    p
        | The strategy is then to show
        me r_3(n)  \gg n^{1/2- \epsilon}\,\forall \epsilon \gt 0
        me r_3(n)  \ll n^{k/2 -1/4 - \delta}\,\text{ for some}\,\delta \gt 0
        |.

    definition#def-half-integral-mfs
        title Half-integral weight modular forms
        statement: p
            | Let #[m N \equiv 0 \pmod 4].
            | A modular form of #[term half-integral] weight #[m k \in \frac 12 + \ZZ_{\ge 0}].
            | For #[m \Gamma_0(N)] is a holomorphic function on #[m \HH] s.t.
            ol
                li: me f(\gamma z ) = j(\gamma;  z)^{2k} f(z)
                li #[m f] is holomorphic at the cusps
            | if #[m \chi\begin{pmatrix}a\amp b \\c \amp d \end{pmatrix} = \chi (d)], #[m  f(\gamma z)  = \chi(d) j(\gamma ; z)^{2k} f(z)] gives the space #[m M_k(\Gamma_0(N), \chi)].
            // TODO check

    p
        | Where do these things come from?

    p
        | A construction due to Schoenberg 1939, Pfetzer 1953, Shimura 1973 is as follows:
    p
        | #[m A] an #[m n \times n] positive definite integral matrix, #[m N \in \ZZ] s.t. #[m N A\inv] is integral, #[m P] a spherical harmonic relative to #[m A] i.e. for #[m P] homogeneous of degree #[m v].
        me \sum_{i,j} \tilde a_{ij} \frac{\partial ^2 P}{\partial x_ix_j} = 0
        me [a_{ij}] = A \inv
    definition
        statement: p
            | Let #[m h\in \ZZ^n], set
            me \tilde \theta_P (z,h,N) = \sum_{m \equiv h \pmod N} P(m) e\left(  \frac{(m^\transpose A m)z}{2N^2} \right)
            | .
    fact
        title Poisson summation
        p
            me \tilde \theta_P (\gamma z, h, N) = e \left( \frac{ab(h^\transpose Ah) }{2N^2}     \right)\left( \frac{\det A}{d} \right) \left( \frac{2c}{d}\right)^n \epsilon_d^{-n} (cz+d)^{k/2} \tilde\theta_P(z; ah, N)
            me \gamma = \begin{pmatrix}a\amp b \\ c \amp d\end{pmatrix} \in \SL_2(\ZZ) : b \equiv 0 \pmod 2,c\equiv 0 \pmod{2N}
            me k = n +2v

    example
        statement: p
            | #[m n = 1, N = 1] #[m P(m) = m^v] #[m v= 0,1]
            me \tilde \theta_P(z) = \sum_{m\in \ZZ} m^v e(m^2z/2)
            | for #[m v=0] this is classical #[m \theta] for #[m v = 1] cusp form on #[m \Gamma_0(8)] of weight #[m 3/2], we could also twist by a character mod 4.
    example
        statement: p
            | #[m A = I_{n \times n}] #[m P] spherical harmonic of degree #[m v]
            me \tilde \theta_P(z; 0, 1) = \sum _{m \in \ZZ^n} P(m) e(|m|^2 z/2)
            | set #[m z=2z]
            me \theta_P(z) = \sum_{m\in \ZZ} P(m) e(|m|^2 z)
            | .
    note
        p
            me \theta_P (z) \in S_k(\Gamma_0(4))
            me k = \frac h2 + v,\,v \gt 0
            me \theta_P (z)\in M_{h/2}(\Gamma_0(4))
            | not cuspidal.
    example
        statement: p
            | #[m A = 4\times 4] integral positive definite
            me Q = Q_A(x),\, x^\transpose A x
            me r_Q(n) = \# \{ x \in \ZZ^4:Q(x) = n\}
            me \theta_Q(z) = \sum_{n=0}^\infty r_Q(n) e(nz) \in M_2(\Gamma_0(N))
            | for some #[m N = 4\det(A)].

    paragraphs
        title Half-integral weight Ramanujan conjecture (Metaplectic)

        p
            | Naively we would like to mimic the integral case and say
            me a_f(n) = O(n^{(k-1)/2 + \epsilon})
            | where #[m f\in S_k(\Gamma)].
        p
            | But this is not true as stated here!:

        example
            statement: p
                | Let
                me \theta(z;  \chi) = \sum_{m\in \ZZ} m \chi(m) e(m^2 z)
                | for odd #[m \chi] this is a cusp form in #[m S_k(\Gamma, \chi)].
                | For #[m k=3/2], let #[m f =\theta] and
                me a_f(m^2) \sim m\chi(m) \implies a_f(n) = O(\sqrt{n})
                | for #[m n] square.
                | But #[m (k -1)/2= 1/4] but  #[m O(\sqrt n)] is not #[m O(n^{1/4 + \epsilon})] for any #[m \epsilon \ge 1/4].

        p
            | So we avoid these or stick to squarefree #[m n].

        conjecture#conj-half-integral-ramanujan
            title Half-integral weight Ramanujan conjecture
            statement: p
                me a_f(n) = O(n^{(k-1)/2 + \epsilon})
                | for all #[m n] square-free #[m f\in S_k(\Gamma, \chi)].

        p
            | Why this exponent?
            | For integral weight:
            | Representation theory gives #[m a_f(m)]'s  which correspond to Hecke eigenvalues which under Langlands are tempered for #[m \GL_N].

        p
            | Digression:
        proposition
            title Hecke bound
            statement: p
                | #[m f \in S_k(\Gamma)] then #[m a_f(n) = O(n^{k/2})].
            proof: p
                | #[m y = \Im(z), y(\gamma z) = |cz+d| ^{-2} y] so
                me F(z) = y^{k/2}  |f(z)|
                | Invariant on #[m \Gamma] bounded at the cusps #[m |F(z)| \lt M].
                | So
                me \int_0^1 f(z) e(nx) = e^{-2 \pi i ny }a_f(n)
                me \le \int_0^1 y^{-k/2} M = O(y^{-k/2})
                | so #[m a_f(n) = O(y^{-k/2} e^{2\pi i n y})] with #[m y = 1/n].

    p
        | Another digression:
    p
        | What is the distribution of rational points on #[m S^2]?
        me \{x_1^2 + x_2^2 + x_3^2 = 1: x_i \in \QQ\}
        me \iff r_3(n^2)
    proposition
        title Hurwitz
        statement: p
            | A generating function for this is given by
            me \sum_{n =1}^\infty \frac{r_3(n^2)}{n^s} = 6(1-2^{1-s}) \frac{\overbrace{\zeta(s) \zeta(1-s)}^{=\sum \sigma(n)/n^s}}{L\left(s, \legendre{-1}{\cdot}\right)}
    exercise
        statement: p
            | Prove this!

    paragraphs
        title David Fried's proof of Hurwitz on #[m r_3(n^2)]

        p
            | Without proof Hurwitz stated
            me r_3(N^2) =  6 P \prod_{q|Q} ( q^a + 2q^{a-1} + \cdots + 2q + q)
            | where #[m N = 2^k PQ] and each prime factor of #[m P] is #[m \equiv 1 \pmod 4] and each prime factor of #[m Q] is #[m \equiv -1 \pmod 4] and
            me q^a || Q
            | he suggested a proof along the lines of his published note on
            me r_5(N^2)
            | , here is such a proof:

        p
            | We denote #[m P =  P(N), Q = Q(N)]
            | We may suppose #[m  k = 0] since
            me r_3(4n) =  r_3(n)
            | (each solution of #[m 4n = x^2 + y^2 + z^2] has #[m x,y,z] all even).
            | So  #[m N] is odd and each solution of #[m N^2 = x^2 + y^2 + z^2] has two of #[m x,y,z] even.
            | Hence
            me r_3(N^2) =  \frac 32  \sum_{x \text{ even}} r_2( N^2-  x^2) = \frac 22 \sum_{a+b = 2N,a,b\text{ odd}} r_2(ab)
            | now #[m r_2(n)] is the number of Gaussian integers #[m z] with #[m z \bar z = n].
            | As #[m \ZZ \lb i \rb] is a PID with 4 units #[m \pm 1, \pm i], the function #[m \rho(n) =  \frac 14 r_2(n)] is multiplicative!
            me \rho (ab) = \rho(a)\rho(b) \text{ if } a,b \text{ coprime}
            | clearly
            me r_3(N^2) = 6 \sum_{a+b = 2N,\,a,b\,\text{odd}}\rho (ab)
            | . To evaluate #[m \rho(ab)] we need spme standard functions,
            me \tau(n)= \# \text{divisors }d\text{ of }n,\,\sigma(n) = \sum d
            | the Möbius function #[m \mu(n)].
            | and
            me \square (n) = \frac 12 r_1(n)
            me w(n) = \mu(P)|\mu(Q)|
        p
            | The multiplicativity of #[m \rho] generalises as follows:
        lemma
            statement: p
                | If #[m a,b] are odd with #[m g=  \gcd(a,b)] then
                me \rho(ab) = \sum_{d|g} w(d) \rho\left(\frac ad \right)  \rho\left(\frac bd \right)
            proof
                p
                    | Each #[m p = a^2 + b^2] with #[m a\gt b \gt 0] uniquely (Euler).
                    | Let #[m z(p) = a+bi].
                    | For #[m n] odd #[m n =  PQ] and #[m r_2(n) = 0] unless #[m Q = \square].
                    | In which case the solutions of #[m n = z \bar z] are
                    me z = i^k \sqrt Q \prod_p z(p)^j \overline{z(p)}^{\alpha- j}
                    | where #[m p^\alpha || P], #[m k \in \ZZ/4].
                    | Thus
                    me \rho(n) = \tau(p) \square (Q)
                    | .
                p
                    | When #[m \rho(ab) = 0] every term on the right vanishes.
                    | For #[m Q(ab) \ne \square] so
                    me Q\left( \frac ad \right),\,Q\left( \frac bd \right)
                    | cannot both be squares.
                p
                    | When #[m \rho(ab) \ne 0] we have #[m Q(ab) = m^2] for some#[m m].
                    | There is exactly one squarefree #[m \gamma] dividing #[m m] and #[m g] such that
                    me Q\left(\frac a\gamma \right),\, Q\left(\frac b\gamma \right)
                    | are squares.
                    | The term
                    me w(d) \rho(a/d) \rho(b/d)
                    | is nonzero just when  #[m \alpha = \gamma\delta] where #[m \delta] is squarefree and #[m \delta|P(g)] so the sum reduces to
                    me \sum_\delta \mu(\sigma) \tau(P(a/\gamma\delta)) \tau(P(b/\gamma\delta))
                    me = \sum_\delta \mu(\delta) \tau(P(a)/\delta) \tau(P(b)/\delta)
                    | but
                    me \sum_{d|r,d|s} \mu(d) \tau(r/d) \tau(r/s) = \tau(rs)
                    | by multiplicativity of #[m \tau] this reduces to the case where #[m r = \pi^k,s= \pi^l] for prime #[m \pi] but #[m 1+ k + l =  (1+k)(1+l) - kl].
                    | Here now #[m r=P(a), s=P(b),\gcd(r,s) = P(g)].
                    | So the sum over #[m \delta] equals
                    me \tau(P(a)P(b)) = \tau(P(ab)) \square (Q(ab)) = \rho(ab)
                    | as desired.

        p
            | Using this we find
            me r_3(n^2) = 6 \sum_{d|N} w(d) S \left(\frac Nd\right)
            | where for odd #[m n]
            me S(n)  = \sum_{a+b = 2n,\,a,b\,\text{odd}} \rho(a) \rho(b)
            | but
            me S(n) = \frac{1}{16}\#(2n =  \underbrace{w^2 + x^2}_{\text{odd}}+ \underbrace{y^2 + z^2}_{\text{odd}})
            me      = \frac{1}{4}\#(2n =  4w^2 + 4x^2+y^2 + z^2)
            me = \sigma(n)
            | by Jacobi.
        p
            | So
            me r_3(N^2)=  6\sum_{d|N} w(d) \sigma\left(\frac Nd\right)
            me = 6(w \ast \sigma) (N)
            | where #[m \ast] denotes Dirichlet convolution.
        p
            | Pasing to Dirichlet series
            me \sum_{N\text{ odd}} \frac{ r_3 (N^2)} {N^s} = 6 \sum _{d\text{ odd}} \frac{w(d)}{d^s } \sum _{m\text{ odd}} \frac{\sigma(m)}{m^s }
            me = 6\underbrace{ \prod_p(1- p^{-s})\prod_q (1+ q^{-s})}_{L(s, \legendre{-4}{\cdot})\inv}\underbrace{\sum_{k \text{ odd}} \frac{1}{k^s}}_{\zeta_{\text{odd}}(s-1)}\underbrace{\sum_{l \text{ odd}} \frac{l}{l^s}}_{\zeta_{\text{odd}}(s-1)}
            me = 6\prod_p \sum_a \frac{p^a}{p^{as}} \prod_q \sum_a \frac{q^a + 2q^{a -1} + \cdots  + 2q + 2} {q^{as}}
            | which gives
            me r_3(N^2) = 6 \prod_{p^a||N} p^a \prod_{q^a||N} (q^a + 2q^{a-1} + \cdots 2q + 2)
            | as in Hurwitz and
            me \sum_{n=1}\infty \frac{r_3(n^2)}{n^s} = 6 L(s, \legendre{-4}{\cdot}) \inv \zeta(s) \zeta_{\text{odd}}(s-1)
            | as in Duke.

    aside: p Lecture 10 16/10/2018

    corollary
        statement
            p
                | This shows
                me r_3(n^2) \gg n
                | .
        proof
            title Proof (sketch)
            p
                |Expand the formula, take #[m n=p] an odd prime
                me \zeta(s) \zeta(1-s) = \sum \frac{\sigma(n)}{n^s}
                | (exercise)
                me L(s, \chi_{-4})\inv = \prod_p(1- \frac{\chi_{-4}(p)}{p^s})
                | so
                me \sum \frac{r_3(n^2)}{n^s} = \sum \frac{\sigma(m_1)}{m_1^s} \prod (1 - \chi_{-4}(m_p)/p^s) 6 (1-2^{1-s})
                me                           = \sum \frac{\sigma(m_1)}{m_1^s} \sum \mu(m_) \chi_{-4}(m_2)/m_2^s 6 (1-2^{1-s})
                | so
                me r_3(p^2) = (\sigma(p) - \chi_{-4}(p))6 \ge 6p

    p
        | The next big breakthrough came much later, showing something similar for #[m r_3(n, P)], but now we hope to see cancellation.

    theorem
        title Shimura '71
        statement
            p
                | Let
                me f \in S_{k/2}(N,\chi)
                | be a half integral weight cusp form, #[m k] odd, #[m 4|N].
                me f(z) = \sum_{n=1}^\infty a_f(n) e(nz)
                | , assume #[m f] is a common eigenfunction for all #[m T_{p^2}].
            p
                | Let #[m \widetilde \chi(m) = \chi(m) \chi_{-4}(m)] and #[m \lambda  = (k-1)/2].
                | Set
                me \sum_{n=1}^\infty \frac{A(n)}{n^s} = L(s+1 - \lambda , \widetilde \chi) \cdot \left( \sum_{m=1}^\infty   \frac{a_f(m^2)}{m^s}        \right)
                me F(z) = \sum_{n=1}^\infty A(n) e(nz)
                | .
            p
                | Then
                me F(z) \in S_{2\lambda}(N_1, \chi^2)
                | .

    p
        | Recall:
        me \theta_P(z) = \sum r_3(n; P) e(nz) \in S_{3/2 + l} (\Gamma_0(4))
        | is a weight #[m 3/2 +l] form if #[m l=  \deg P].
    p
        | Shimura gives us
        me F_P(z) \in S_{2l+2}(\Gamma_0(2))
        | then we get

    corollary
        statement: p
            me r_3(n^2, P) = \sum_{d|n} A_P(d)  \mu\left(\frac nd \right) \chi_{-4}\left(\frac nd\right) \left(\frac nd\right)^l
            | hence if #[m A_P(d) \ll d^{l+1 -\delta}] then we are done.

    p
        | The Hecke bound implies #[m A_P(d) \ll d^{l +1}].

    paragraphs
        title Detour: bounding Fourier coefficients

        p
            | There are various approaches, such as Poincaré series, Kloosterman sums, and bound these, to get a bound on the Fourier coefficient.

        p
            | If #[m f\in S_{k_1} (N_1)] we will write  a spanning set for #[m S_{k_1}(N_1)], then bound fourier coefficients on each of these guys, which will suffice.

        p
            | Poincaré series:
        p
            | If we were just looking for a modular form we might try Eisenstein series
            me E_k(z) = \sum_{c,d} \frac{1}{(cz+d)^{2k}}
            | these are not cuspidal.
            | But if we twist this  a little bit
            me P_m(z; k) = \sum_{\gamma \in \Gamma_\infty \backslash \Gamma} j(\gamma;   z)^{-2k} e(m \gamma z)
            | .
        p
            | Where #[m \Gamma_\infty = \left\{ \begin{pmatrix} 1\amp n \\ 0 \amp 1 \end{pmatrix}\right\}].
            me j(\gamma; z) = \left( \frac cd \right) \epsilon_d \inv (cz+d)^{1/2}
            | they converge absolutely for #[m k \gt 2].

        p
            | Some properties:

        lemma
            statement: p
                me P_m(\tau z; k) = (cz+d)^{2k}  P_m(z; k)
            proof
                p
                    | Exercise, #[m j] satisifes a cocycle relation
                    me j(\gamma ; \tau z) j(\tau; z)  = j(\gamma \tau; z)
                    | .
        proposition
            statement: p
                me P_m(z) \in S_k(\Gamma)
            proof: p
                | To follow.

        lemma
            statement: p
                | Let #[m f(z) = \sum a_f(n) e(nz)]
                me \pair{P_m(z; k) }{ f}_\mathrm{Pet} =\frac{\overline a_f(m) }{(4 \pi m)^{k-1}}\Gamma(k-1)
                |.
            proof
                p
                    me \pair{P_m(z; k) }{f}_{\mathrm{Pet}} = \int_{\Gamma \backslash \HH} P_m(z; k) \overline f(z) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \int_{\Gamma\backslash  \HH} \sum_{\gamma \in \pm \Gamma_\infty \backslash \Gamma} j(\gamma;   z)^{-2k} e(m \gamma z) \overline f(z) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \sum_{\gamma \in \pm \Gamma_\infty \backslash \Gamma}\int_{\Gamma\backslash  \HH}  j(\gamma;   z)^{-2k} e(m \gamma z) \overline f(z) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \int_{\Gamma_\infty\backslash  \HH}  e(m z) \overline f(z) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \int_0^1 \int_0^\infty e(m z) \overline f(z) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \overline a_f(m) \int_0^\infty e(2 m iy ) y^k  \frac{\diff x \diff y }{y^2}
                    me                                     = \frac{\overline a_f(m) }{(4 \pi m)^{k-1}}\Gamma(k-1)

    aside: p Lecture 11 18/10/2018

    corollary
        statement: p
            | #[m P_m(z; k)] span #[m S_k(\Gamma)] as #[m m] varies through integers.
        proof: p
            | If #[m f \perp P_m(z, k)] for all #[m m] then #[m f=  0].

    observation
        p
            | The corollary implies that bounding fourier coefficients of #[m f\in S_k(\Gamma)] is equivalent to bounding fourier coefficients of #[m P_m(z,k)].


    proposition
        statement: p
            me \pair{P_m(z,k)}{P_n(z,k)} = \left( \frac mn \right)^{(k-1)/2} \left(\delta_{m,n} + \frac{2\pi}{i^k} \sum_{c\equiv 0 \pmod N} J_{k-1} \left( \frac{2\pi \sqrt{mn}}{c} \right)\frac{K(m,n; c)}{c}\right)
            | where
            me J_k \text{ is the Bessel function of the first kind}
            me N\text{ s.t. } \Gamma = \Gamma_0(N)
            me K(m,n; c) = \sum _{d\in (\ZZ/c)^\times } \left(\frac cd \right)^{2k} \epsilon_d^{-2k} e\left(\frac {m\overline d + nd}{c}\right)
            me \delta_{m,n} = \begin{cases} 1 \amp m=n,\\ 0 \amp m\ne n\end{cases}
            |.

        proof
            p
                md
                    mrow \int_0^1 P_m(z,k) e(-nz) \diff z \amp= \int_0^1 \left( \sum_{\pm \Gamma_\infty \backslash \Gamma} j(\gamma ; z) ^{-2k} e(m\gamma z)\right) e(-nz) \diff z
                    mrow                                \amp= \int_0^1 \underbrace{j(1; z)^{-2k} e((m-n)z)}_{\delta_{m,n}} \diff z + \text{rest}
                    mrow                                \amp= \int_0^1 j(1; z)^{-2k} e((m-n)) \diff z + \text{rest}

            p
                | Note:
                me e(\begin{pmatrix} 1\amp n \\ 0 \amp 1 \end{pmatrix} z) = e(z)
                | .
            p
                | So
                me \int_0^1\sum_{\Gamma_\infty\backslash \Gamma} j(\gamma; z)^{-2k} e(m \gamma z) \diff z
                me = \int_0^1sum_{\Gamma_\infty\backslash \Gamma /\Gamma_\infty} \sum_{\gamma_\infty \in \Gamma_\infty} j(\gamma \gamma_\infty z)^{-2k} e(m\gamma \gamma_\infty z) e(-nz) \diff z
                me \int_0^1 \sum_{\Gamma_\infty\backslash \Gamma /\Gamma_\infty} \sum_{\alpha \in \ZZ} j(\gamma ; z+ \alpha )^{-2k} e(m\gamma (z + \alpha)) e(-nz) \diff z
                me \int_0^1 \sum_{\Gamma_\infty\backslash \Gamma /\Gamma_\infty} j(\gamma ; z)^{-2k} e(m\gamma z-nz) \diff z

            p
                | Note:
                me m\gamma z  = m \frac{az+ b}{cz+d} = m \left( \frac ac - \frac{1}{c(cz+d)}\right)
                me \pm \Gamma_\infty \backslash \Gamma / \Gamma_\infty  =\{ (a,d,c) : c \gt 0 ,\,a,d \in (\ZZ/c)^\times,\,ad \equiv 1 \pmod c\}

            p
                | So our main integral is
                me \sum_{c\gt 0 ,\,d\in \ZZ/c^\times} \epsilon_d^{-2k} \left(\frac cd \right)^{2k}   \int_{-\infty}^\infty \frac{1}{(cz+d)^k} e\left(m\frac ac - \frac{m}{c(cz+d)} -nz\right) \diff z
                me \sum_{c\gt 0 ,\,d\in \ZZ/c^\times,\,ad\equiv 1 \pmod c} \frac{e((ma+nd)/c)}{c^k} \epsilon_d^{-2k} \left(\frac cd \right)^{2k}   \int_{-\infty}^\infty \frac{1}{z^k} e\left( - \left(zn + \frac{m}{c^2z} \right)\right) \diff z


            p
                | Then use the following integral representation
                me \int_{-\infty + iA}^{\infty + iA} w^{-k} e^{-(\mu_1 w + \mu_2 m\inv)} \diff w
                me  = 2\pi \left(\frac {\mu_1}{\mu_2}\right)^{(k-1)/2} e^{i k \pi / 2} J_{k-1} (4 \pi \sqrt{\mu_1\mu_2})

    p
        | To recap:
        me P_m(z) = \sum_{n=1}^\infty \hat P_m(n) e(nz)
        me \hat P_m(n) = \left( \frac nm \right)^{(k-1)/2} \left\{ \delta_{m,n} + \frac{2\pi}{i^k} \sum_{c\equiv 0 \pmod N,\,c \gt 0} J_{k-1} \left( \frac {4\pi \sqrt{mn}}{c} \right) \frac{K(m,n; c)}{c} \right\}

    p
        | Digression: Let #[m \Gamma = \SL_2(\ZZ)], #[m k= 12] then #[m S_k(\Gamma) = \langle \Delta \rangle]
        me \Delta(z) = (2\pi)^{12} \sum_{n=1}^\infty \tau(n) e(nz)
        | .
    p
        | As #[m \Delta = \eta^{24}] we have #[m \tau(n) \in \ZZ].
    p
        | As
        me P_{m}(z; 12) \in S_{12} (1) = \langle \Delta\rangle
        me \implies P_{m}(z; 12) = \kappa(m) \Delta
        | to calculate #[m \kappa(m)]
        me \pair{P_m(z)}{\Delta} = \frac{\overline a_m}{(4\pi m )^{k-1}}  \Gamma(k-1)  = \frac{2 \pi \overline{\tau (m)}}{(4 \pi m)^{k-1}} \Gamma(k-1) = \frac{2\pi 10!}{(4\pi m )^{11}}
        | so
        me P_m(z) = \frac{2\pi 10!}{(4\pi m )^{11}} \frac{\Delta(z)}{\| \Delta\|^2_{\mathrm{Pet}}} \tau(m)
        |.

    p
        | Another consequence:
    theorem
        title Petersson trace formula
        statement: p
            | For any  #[m m,n \ge 1 ]
            me \frac{\Gamma(k-1)}{ ( 4\pi \sqrt{mn})^{k-1}} \sum_{f\text{ o.n. basis for }S_k(\Gamma)} \overline a_f(m) a_f(n) = \delta_{m,n} +  \frac{2\pi}{i^k} \sum_{c\equiv 0 \pmod N,\,c \gt 0} J_{k-1} \left( \frac {4\pi \sqrt{mn}}{c} \right)  \frac{K(m,n; c)}{c}
            | .
        proof
            p
                | Let #[m P_m(z) = \sum_f \pair{P_m(z)}{f}f] then
                me \pair{P_m(z)}{P_n(z)} = \sum_f \overline {a_f(m)} a_f(n) \frac{\Gamma(k-1)^2}{(4 \pi m)^{k-1} (4\pi n )^{k-1}}
                | on the other hand
                me \pair{P_m(z)}{P_n(z)} = \frac{\Gamma(k-1)}{(4\pi m)^{k-1}} \left(\frac mn\right)^{(k-1)/2} \left\{ \cdots \right\}
                | .

    aside: p Lecture 12 23/10/2018

    p
        | Recall Shimura gave us
        me \sum_{n=1}^\infty  \frac{r_3(n^2, P)}{n^s} = \frac{\sum_{n=1}^\infty \frac{A_P(n)}{n^s}}{L(s-l, \chi_{-4})}
        | where the numerators is the #[m L]-function of a modular form of weight #[m 2l + 2] where #[m l = \deg P].
    p
        | We want to show #[m A_P(n) \ll n^{1+l-\delta}] for some #[m \delta \gt 0].

    p
        | Idea:
        | Poincaré series span cusp forms, so its enough to bound Fourier coefficients of these.

    p
        | We know
        me \hat P_m(n) = \left(\frac nm \right)^{(k-1)/2} \left( \delta_{m,n} + 2 \pi i^{-k} \sum_{c \equiv 0 \pmod N,\, c \gt 0}\overbrace{\frac{K(m,n,c)}{c}}^{\sum_{x \pmod{^* c}} e((x m + \overline x n)/c)} J_{k-1} \left(\frac {4 \pi \sqrt{mn}}{c}\right) \right)
        | .
    p
        | Try: Input 1:
        me J_{k-1}(x) \ll \min\{x^{k-1},1/\sqrt{x}\}
        | .
    p
        | Trivial input:
        me | K(m, n; c) | \lt c
        | .

    p
        | For
        me c \gg \sqrt{mn} \leadsto J_{k-1}\left( \frac{4 \pi \sqrt{mn}}{c} \right) \sim \left( \frac{\sqrt{mn}}{c} \right)^{k-1}
        me                  \lt \left(\frac nm \right)^{(k-1)/2} \sum_{c \gg \sqrt{nm}} \frac{1}{c^{k-1}} (mn)^{(k-1)/2}
        me                           \lt n^{k-1} \frac{1}{\sqrt{mn}^{k-2}} = O(n^{k-1 - (k-2)/2})
        | for
        me c \ll \sqrt{mn} \leadsto J_{k-1}\left( \frac{4 \pi \sqrt{mn}}{c} \right) \sim \frac{\sqrt c}{(mn)^{1/4}}
        me \lt \left( \frac nm \right)^{(k-1)/2} \sum_{c\ll \sqrt{nm}} \frac{\sqrt{c}}{(mn)^{1/4}} = O (n^{k/2})
        | .

    p
        | Note #[m k/2 = l+1]:
        | So we are just short, we have #[m O(n^{l+1})] rather than #[m O(n^{l+1-\delta})] for all #[m \delta \gt 0], just by using a stupid bound for #[m K(m,n; c)].

    p
        | More major input (Weil bound):
        me |K(m,n \chi ) | \ll_\epsilon c^{1/2 +\epsilon}
        me \implies | \hat P_m(n) | = O(n^{k/2 - 1/4 + \epsilon})
        | so
        me \forall \epsilon \lt \frac 14
        | this does the job.
    p
        | So we have finished proving Linnik for #[m n^2], it wasn't too bad, the major inputs were the Shimura correspondence.
    p
        | When we move to the general case things will be totally different.

    remark
        p
            | Weil bound comes from the Riemann hypothesis for curves over finite fields.

    lemma
        statement: p
            | Let #[m  p] be an odd prime #[m p\nmid mn].
            me \sum_{x \pmod{^* p},xy=1} e\left( \frac{xm + \overline yn}{p}\right)  = \sum_{x^2 - n \overline m = y^2 \pmod p}          e\left( \frac { 2mx}{p} \right)
        proof
            p
                | Reparameterise #[m xy =1], #[m x= a+b,y= a-b].
                | Exercise.

    lemma
        statement: p
            me \sum_{x \pmod p} \legendre{x^2 - n \overline m}{p} e\left( \frac {2m x}{p}\right) = \sum_{x^2 - \overline m n y^2} e\left( \frac{2xm}{p}\right)
            | .
        proof: p
            me \sum_{x \pmod p} \legendre{x^2 - n \overline m}{p} e\left( \frac {2m x}{p}\right) = \sum_{x\pmod p} \left(\legendre{x^2 - n \overline m}{p}  + 1 \right) e\left( \frac {2m x}{p}\right)
            | .

    note
        p
            | LHS is calculating a Fourier coefficient.
            | i.e.
            me h_{m,n} (\alpha) = \legendre{\alpha^2 - \overline m n }{p}
            me \text{LHS} = \hat h(2m)
            | the above two lemmas imply
            me K(m,n ; p)
            | is the Fourier coefficient #[m \hat h_{m,n}(m)].

    p
        |So
        me h(\QQ(\sqrt{u^2 - 4\overline m n})) \sim L\left( 1, \legendre{u^2 - 4 \overline  m n}{\cdot} \right)
        me \text{Selberg trace formula} \leftrightarrow_{\text{Fourier transform}} \text{Petersson trace formula}
        |.


    remark
        p
            | In the non-square case we want #[m |r_3(n,P)| \ll n^{k/2 - 1/4 - \delta}].
    p
        | This is because of the subtlety of the Shimura correspondence.
    p
        | More precisely for #[m n] squarefree #[m n^{k/2 - 1/4 - \delta}]
        me \theta(z; P) \text{ weight } \frac 32 + \deg P = k
        me r_3(n ; P) \gg n^{1/2 - \delta}
        | want
        me r_3(n; P ) \ll n^{k/2 - 1/4 - \delta}
        me \sum_{|\alpha|^2 = n} P\left( \frac{\alpha}{|\alpha|}\right) = |n|^{-\deg P / 2} r_(n ,  P)
        me r_3(n, P )  \lt n^{k/2 - 1/4 - \delta} = n^{3/4 + \deg P/2 - 1/4 - \delta}
    p
        | for #[m n^2]
        me r_3(n^2) \gg n
        | have Shimura
        me \theta(z; P) \leadsto \text{weight }k
        me A_p(n^2)
        | are fourier coefficients of a weight #[m 2 \deg P  + 2] form.

    paragraphs
        title Back to #[m r_3(n,P)]
        p
            | #[m n]-squarefree, we don't  have Shimura, but we still have the Fourier expansion of #[m P_m(z)].

        p
            | Strategy:
            | We will first exploit a certain form of these Kloosterman sums for #[m  \Delta] squarefree, Salié sums.
            | Major detail
            me \sum_c \frac{K(m, n ; c)}{c}
            | will bound these not individually, but by showing that the angles of these cancel.
            | We show other equidistribution results from equidistribution of Kloosterman sums essentially.


    aside: p Lecture 13 25/10/2018

    paragraphs
        title Main issue

        p
            me \sum_c \frac{K(m,n ; c)}{c} J_{k-1} \left(\frac{4\pi \sqrt{mn}}{c}\right)
            | saw that bounding each individual #[m K(m, n; c)] falls short of what is needed.

    paragraphs
        title Detour (Salié sums)

        p
            | Recall for #[m  k = \frac 32 + l] the sums we are getting are
            me K_k(m, n ; c) = \sum_{d \pmod{^* c}} \epsilon_d^{-2k} \left(\frac cd \right) e\left( \frac{ md + n \overline d}{d} \right)
            | where
            me \legendre{c}{d} \text{ Kronecker symbol}
            me  \epsilon_d = \begin{cases} 1 \amp d \equiv1 \pmod 4,\\ i \amp d \equiv -1 \pmod 4\end{cases}
        p
            | It will turn out that these sums can be calculated in elementary terms.
            | Analogy
            me K_k(m, n ; c) \leftrightarrow K_k
            | for #[m k \in \frac 12 + \ZZ], #[m J_k(x)] is expressible in terms of elementary functions, e.g.
            me J_{1/2}(x) = \sqrt{\frac{2}{\pi x}} \cdot \sin(x)
            me J_{3/2}(x) = \sqrt{\frac{2}{\pi}} \cdot\left(\frac{\sin(x)}{x^{3/2}} -\frac{\cos(x)}{\sqrt x}  \right)
        p
            | Calculation:
            | Reductions:
        lemma
            statement: p
                | Let #[m c = rq] with #[m (r,q) = 1] and #[m 4\mid r],
                me K_k(m,n; c) = K_{ k- q + 1}(m \overline q, n \overline q ; r) S(m \overline r, n \overline r; q)
                | where
                me S(m, n; q) = \sum_{x \pmod{^* q}} \legendre{x}{q} e\left(\frac{mx + n \overline x}{q}\right)
                | is the Salié sum.
        exercise
            statement: p
                | Prove this.

        lemma
            statement: p
                | #[m q] prime
                ol
                    li
                        me S(m,n ; q)   = \legendre mn S(q, mn; q)
                    li
                        me S(1, m; q) = 0
                        | unless #[m \legendre{m}{q} = 1].
                    li
                        me S(1, n^2; q) = \underbrace {\epsilon_q  \sqrt q}_{G(q)} \sum_{x^2 \equiv1 \pmod q} e\left(\frac{2xn}{q}\right)
            proof
                p
                    ol
                        li
                            me x = \overline m y
                        li
                            me x = m \overline y
                        li
                            me S(1, n^2; q) = \sum_{x\pmod{^* q}} \legendre{x}{q} e\left( \frac{x + n^2 \overline x}{q}\right)
                            | recall DFT
                            me f(u) = \frac 1q \sum_{\alpha \pmod q} \hat f(\alpha) e\left( \frac{\alpha u}{q}\right)
                            me \hat f(\alpha) = \sum _{u\pmod q} f (u) e\left( \frac{-\alpha u}{q}\right)
                            me = \sum_{q\pmod q} \sum _{x\pmod{^* q}} \legendre xq e \left( \frac{x + u^2 \overline x}{q} \right) e\left(\frac{-\alpha u}{q} \right)
                            me  = \sum_{u \pmod q,x\pmod{^* q}} \legendre xq e\left(\frac xq\right) e\left( \frac{y^2 \overline x  - \alpha u}{q}\right)
                            me  = \sum_{x\pmod{^* q}} \legendre xq e\left( \frac{x(1- \overline 4x^2)}{q}\right)\underbrace{ \sum_{u \pmod q} e\left(\frac{\overline x (u - 2\alpha x)^2}{q}\right)}_{\legendre xq G(q)}
                            me G(q) \sum_{x \pmod{^* q}} e\left( \frac{ x (1 - \overline 4 \alpha^2)}{q}\right)
                            | we need some more results to conclude!

        lemma
            statement: p
                | Let
                me c_q(r) = \sum_{x\pmod{^* q}} e\left( \frac{rx}{q}\right)
                | then
                me c_q(r) = \sum_{d|gcd(q,r)} \mu\left(\frac qd \right) d
                | .
            proof: p
                me c_q(r) = \sum_{x\pmod{^* q }}e\left( \frac{xr}{q} \right)
                me =\sum_{d|q} \sum_{a \pmod {^* q/d}} e\left( \frac{ar}{q/d}\right)
                me =\sum_{d|q} c_{q/d} (r)
                me =\sum_{d|q} c_d(r)
                | let
                me F(q)=\sum_{d|q} c_d(r)
                | then by Möbius inversion
                me c_q(r)  = \sum_{d|q} \mu\left( \frac dq\right) F(d)
                me F(d) = \sum_{x\pmod d} \left(\frac{xr}{d} \right) = \begin{cases} d \amp \text{ if } d|r,\\0 \amp \text{otw} \end{cases}

        note
            p
                me c_q(r) = \mu \left( \frac{q}{\gcd(q,r)}\right) \frac{\phi (q)}{\phi(q/\gcd(q,r))}

        p
            | This lemma implies that in the proof above we have
            me G(q) c_{q} (q-  \overline 4 \alpha^2) = G(q) \sum_{d|\gcd(q,(1-\overline 4 \alpha^2))} \mu \left(\frac qd \right) d
            | so putting everything together
            me f(u) = \frac 1q \sum_{\alpha \pmod q} \left( G(q) \sum_{d|\gcd(q,(1-\overline 4 \alpha^2))} \mu \left(\frac qd \right) d \right) e\left(\frac{\alpha u}{q} \right)
            me      = \frac{G(q)}q \sum_{d|q} \sum_{\alpha \pmod q,\overline 4 \alpha^2 - 1 \equiv 0 \pmod d} d e\left(\frac{\alpha u}{q} \right)

        lemma
            statement: p
                me \sum_{\alpha \pmod q,\overline 4 \alpha^2 - 1 \equiv 0 \pmod d} e\left(\frac{\alpha u}{q} \right) = 0 \text{ if } d\ne q
            proof: p
                | If #[m d \ne q] then #[m de = q], #[m e \ne 1], #[m \alpha = \alpha_1 + d\alpha_2]
                | so
                me \sum_\alpha = \sum_{\alpha_1,d,\overline 4 \alpha_1 ^2 = 1 \pmod d} e\left( \frac{\alpha_1 u}{q}\right)  \sum_{\alpha_2} e\left( \frac{\alpha_2 u}{q}\right) = 0
                | .

        p
            | This finishes the proof for Salié sums.

        theorem
            title Major theorem (Iwaniec '87)
            statement: p
                | Use this calculation + Petersson formula + genus
                | Let #[m f\in S_k(N)] of weight #[m 2k \ge 1 ] and #[m 2k] odd.
                | Then for #[m n ] squarefree and #[m \forall \epsilon \gt 0]:
                me a_f(n) \ll_\epsilon n^{k/2 - 1/4 - 1/28 + \epsilon}
                | .

        corollary
            statement: p
                me r_3(n, P) \ll n^{k/2 - 1/4 - 1/28 + \epsilon}
                | for all #[m \deg(P) \gt 0].

        p
            | Final input:
            | Lower bound (Gauss, Siegel):
            | Gauss showed
            me r_3(n) = \frac{24}{w(d)} h(d) \left( 1- \legendre d2 \right)
            | where #[m h(d)] is the class number #[m \QQ(\sqrt{-n})] where #[m d = \disc (\QQ{-n})] and #[m w(d)] is the number of roots of unity in this field.
        exercise
            statement: p Show this

        question
            statement: p
                |  How large is #[m h(d)]?
        p
            | Euler, Siegel

        theorem
            statement: p
                me h(D) \gg_\epsilon |D|^{1/2 - \epsilon}
                me L(q,\chi_D)  \gg_\epsilon |D|^{-\epsilon}

    aside: p Lecture 14 30/10/2018

    p
        |Last  time #[m f\in S_k(\Gamma), k \in \frac 12 + \ZZ] for #[m n ] squarefree Iwaniec implies #[m |a_f(n)| \ll_\epsilon n^{k/2  - 1/4 - 1/28 + \epsilon}].
        | This gives #[m r_3(n; P) \ll n^{k/2 - 1/4 - \delta}].

    p
        | Finding the argument #[m P = ] spherical harmonic, #[m \deg (P) = l] and #[m h= l + 3/2].
        me r_3(n; P) = \sum_{|\alpha|^2 = n} P(\alpha)
        | .
    p
        | Today:
    p
        | #[m P \equiv 1] main contribution.
    p
        | #[m P \not \equiv 1] error.

    paragraphs
        title #[m P \equiv 1]

        p
            me r_3(n ) = \sum_{|\alpha|^2= n }1
            | (with no local obstructions, i.e. #[m n ] squarefree and #[m n \not \equiv  7 \pmod 8]).

        theorem
            title Gauss
            statement: p
                me r_3(n) = \frac{24 h(\tilde n)}{w(\tilde n)} \left(1 - \legendre {\tilde n}{2} \right)
                |where
                me \tilde n = \disc(\QQ(\sqrt{-n}))
                me w(\tilde n) = \# \text{roots of 1 in }\QQ(\sqrt{-n})

        note
            p
                | #[m \tilde n \sim n] as we are squarefree so off by at most  a factor of 4.
                | Then #[m r_3(n) \sim h(\tilde n)]

        exercise
            statement: p

                | Prove the theorem.

        p
            | We now wish to demonstrate a lower bound on #[m h(\tilde n)].

        theorem
            title Siegel '35
            statement: p
                | #[m \forall \epsilon \gt 0] have
                me L(1, \chi_d)  \gg_\epsilon |d|^{-\epsilon}
                | .

        corollary
            statement: p
                me h(\tilde n) \gg_\epsilon n^{1/2 - \epsilon}
                | .

        exercise
            statement: p
                | Prove the corollary (Analytic class number formula)

        note
            p
                | The constant in Siegel's theorem is ineffective, meaning one cannot actually calculate it (without proving there are no Landau-Siegel zeroes).
        p
            | Finally Siegel + Iwaniec implies
            me \frac{1}{\sqrt n} \# \{ \alpha \in \ZZ^3 : |\alpha|^2 = n\}
            | gets equidistributed on #[m S^3] as #[m n \to \infty].

    p
        | Recall this above was problem 1.

    paragraphs
        title Problem 2

        p
            | #[m \Gamma = \SL_2(\ZZ)]
            me \frac{1}{\# \Lambda_d} \sum_{z_Q \in \Lambda_d} f(z_Q) \to \int_{\Gamma \backslash \HH} f(z) \diff \mu (z)
            | where for #[m Q = ax^2 + bxy + cy^2], positive definite.
            me z_Q =  \frac{-b + \sqrt{b^2 - 4ac}}{2a} \in \HH
            | .


        theorem
            title Duke '88
            statement: p
                | Problem 2 is true.


    paragraphs
        title Duke's proof

        p: ol
            li
                | What to replace the exponential sums, i.e. the #[m P]'s?

            li
                | Follow the same strategy and bound the nontrivial sums from above (#[m P \not \equiv 1]), trivial sums from below (#[m P \equiv 1]).

        p
            |Recall #[m \lb 0 ,1) \leadsto P = e(nx)], #[m S^2 \leadsto P] spherical harmonics, #[m \Gamma \backslash \HH \leadsto] automorphic forms #[m E(z,s)] or Maass cusp forms.
        p
            | Digression #[m \Delta_{\text{hyp}} \acts \Gamma\backslash \HH] fourier transform on #[m \RR] then #[m f(x) = \int_{i\RR} \hat f(\alpha) e(\alpha x) \diff x]
            me S^1 \implies f(x) = \sum_{n\in \ZZ} \hat f (n) e(nx)
            | i.e.
            me  L^2( \Gamma\backslash \HH) = \oint_\RR E( z, \frac 12 + iit) \diff \mu (t)
            me \bigoplus \sum_\lambda \phi_\lambda
            | #[m \phi_\lambda] a Maass cusp form of eigenvalue #[m \lambda].

        p
            | Detour: Maass forms and Eisenstein series

        definition#def-equidist-maass-form
            title Maass form
            statement
                p
                    | #[m f\colon \HH \to \CC] is a #[term Maass form] if #[m \forall \gamma \in \Gamma = \SL_2(\ZZ)].
                    me f(\gamma z) = f(z)
                    | #[m f] is an eigenfunction for
                    me \Delta_{\text{hyp}} = -y^2 \left( \frac{\partial^2}{\partial x^2 } \frac{\partial^2}{\partial y^2 }\right)
                    me f(z) = O(y^N)
                    | for some #[m N].
                p
                    | Cusp form if
                    me \int_0^1 f(x  + iy) \diff x = 0
                    | .

        example
            title Eisenstein series
            statement: p
                me E(z,s) = \sum_{(c,d)=1} \frac{y^s}{|cz+d|^{2s}}
                me = \sum_{\gamma \in \Gamma_\infty\backslash \Gamma} \im(\gamma z)^s

        fact
            statement: p
                ol
                    li #[m E(z,s)] converges for #[m \Re(s) \gg1].
                    li Has analytic continuation to #[m \CC] in the #[m s]-variable.
                    li Has a simple pole at #[m s =1] which is a constant #[m \Res_{s=1} E(z,s) = \frac 12].
                    li #[m E(z,s) = E(z,1-s)].
                    li #[m E(z,s) \sim y^\sigma] where #[m \sigma = \max \{ \Re(s), \Re(1-s)\}].
        p
            | Back on track
            me \sum_{|\alpha|^2 = n} P\left( \frac {\alpha}{|\alpha|}\right)
            me \sum_{z_Q \in \Lambda_d} 1
            me \sum_{z_Q \in \Lambda_d} E(z_Q, \frac 12 + it)
            me \sum_{z_Q \in \Lambda_d} \phi_\lambda(z_Q)


        lemma
            statement: p
                me \zeta(2s) \sum_{z_Q \in \Lambda_d} E(z_Q, s)
                me \left( \frac {|d|}{4}\right)^{\frac s2} \underbrace{\zeta_{\QQ(\sqrt{d})}(s)}_{=\zeta(s) L(s, \chi_d)}
            proof
                p
                    me \sum_{z_Q} \zeta(2s) E(z_Q,s) =\sum_{z_Q} \sum_{(u,v)\in \ZZ^2 \smallsetminus (0,0)} \frac{y_Q^2}{|uz_Q + v|^2s}
                    | #[m \Lambda_d] the class group of binary quadratic forms of discriminant #[m d].
                    me |uz_Q + v|^2 = |u\left(\frac{-b + \sqrt{d}}{2a}\right) + v|^2
                    me = \frac{av^2 - uv b + cv^2}{a}
                    | so we get in the above
                    me = \left(\frac{|d|}{4a}\right)^{s/2} \sum _{Q\in \Lambda_d} \frac{1}{Q(u,v)^s}
                    | .

        p
            | This gives
            ol
                li
                    me \sum_{z_Q} 1 \sum |d|^{1/2} L(1,\chi_d) \gg_\epsilon |d|^{1/2 - \epsilon}
                    | by Siegel.
                li
                    me \sum_{z_Q} E(z_Q, \frac 12 + it ) \sim \frac{|\zeta(\frac 12 + it) L( \frac 12  + it , \chi_d)|}{|\zeta(1 + 2 it)|} |d|^{\frac 14}
                    | want
                    me L(\frac 12 + it, \chi_d) \ll |d|^{\frac 14 - 8}
                    | .
        p
            | We also need:
        theorem
            title de la Vallée Poussin
            statement: p
                me \zeta(1  + 2i t ) \gg \text{something} \gt 0
                me |\zeta(1+ 2it)| \gg \log(2 + 1 + 1 )\inv

        p
            | Phragmén-Lindelöf principle gives convexity bound on the #[m d]-aspect
            me L(\frac 12  + it, \chi_d   ) \ll_\epsilon | d|^{\frac 14 + \epsilon}
            |.
        p
            | Subconvexity bound
        theorem
            title Burgess
            statement: p
                me L(\frac 12  + it, \chi_d   ) \ll_\epsilon | d|^{\frac 1{16} + \epsilon}
        p
            | What about
            me \sum \phi_\lambda (z_Q)
            | ? Harder even!

    aside: p Lecture 15 1/11/2018

    p
        | Last time
        me \frac{1}{|\Lambda_d|} \sum_{z_Q \in \Lambda_d} f(z_Q) \to \int_{\Gamma \backslash \HH} \diff \mu (z)
        | Siegel's theorem gives a lower bound
        me \frac{1}{|\Lambda_d|} \sum_{z_Q \in \Lambda_d} 1
        | Subconvexity bound  on #[m L(\frac 12 + it, \chi_d)] and non-vanishing #[m \zeta(1 + 2i t)].
        me \frac{1}{|\Lambda_d|} \sum_{z_Q \in \Lambda_d} E(z_Q, \frac 12  + it)
        | is
        me \frac{1}{|\Lambda_d|} \sum_{z_Q \in \Lambda_d} \phi(z_Q)
        | a cusp form?

    paragraphs
        title Waldspurger's formula

        p
            | Roughly Waldspurger says
            me    \frac{|a_{|D|}|}{\pair ff} = \frac{(k - \frac 32)!}{\pi} \frac{|D|^{k-1}}{\pair gg} L(g\otimes \chi_D, k- \frac 12)
            | #[m f\in S_k(\Gamma_0(4)] half integral weight, #[m f\mapsto g] Shimura lift, #[m a_n] fourier coeffs of #[m F].

        remark
            p
                | Shimura lifting takes weight #[m k] to weight #[m 2k-1] so #[m k- \frac 12] is the center of the critical strip of
                me L(g \otimes \chi_D, s)

                | .
                me L(g\otimes, \chi_d, s) = \sum \frac{b_n \chi_D(n)}{n^s}
                | .

    p
        me \sum \phi (z_Q) \leadsto a_{\theta_\phi}(|D|)
        | Katok-Sarnak, compare with
        me P\left(\frac{\alpha}{|\alpha|}\right) \leadsto \sum r_3(P, n) e(nz) = \theta_P(z)
    p
        | Then #[q all we need to do] is to show that
    paragraphs
        title Subconvexity bound
        p
            me L(g \otimes \chi_D, k- \frac 12)  \ll |D|^{\frac 12 - \delta}
            | this would be enough
        p
            | Why? Recall
            me \sum_{|\alpha|^s = n} P(\alpha) \leadsto \theta_P(z)
            me \sum_{|\alpha| = n} P\left( \frac{\alpha}{|\alpha|}\right) = \frac{1}{n^{\deg P/2}} r_3(P; n)
            | #[m \theta_P(z)] of weight #[m \deg P + \frac 32].
        p
            | Want
            me \frac {|a_{|D|}|^2}{|D|^{\deg P}} \ll |D|^{1-s}
            me g =\text{weight } 2k-1 - 2\deg P + 2

            me \sim \frac{|D|^{k-1}}{|D|^{k- \frac 32}} L(g\otimes \chi_D, k - \frac 12)
            me \sim |D|^{\frac 12}L(g\otimes \chi_D, k - \frac 12)
            | final touch:
            me \sum_{z_Q \in \Lambda_d} 1 \gg |d|^{1/2 - \epsilon}
            | so if we can get the subconvex bound
            me \frac{|a_{|D|}|^2}{|D|^{k-3/2}} \ll |D|^{1-\delta}
            | it is enough.

    conjecture
        title Lindelöf
        statement: p
            | In the #[m D]-aspect
            me L(g \otimes \chi_D, \frac 12 ) \ll |D|^\epsilon
            me L(g, \frac 12 + it) \ll (1+t)^\epsilon

    p
        | This follows from GRH.

    lemma
        title Convexity bound
        statement: p
            | For all #[m \epsilon \gt 0]:
            me \zeta( \frac 12 + it )  = O_\epsilon(( 1+ |t|)^{1/4 + \epsilon})
            | .
        proof
            title Proof (sketch)
            p
                me |\zeta(1+ \epsilon + it)| \le \zeta(1+ \epsilon ) \le c_{\epsilon \gt 0}
                | .
            p
                | Functional equation + Stirling gives
                me |\zeta( -\epsilon - it)| = O_\epsilon( |t|^{1/2 + \epsilon})
                me |\zeta(\sigma+ it)| \sim | \zeta(1- \sigma-it) \left| \frac{t}{2\pi} \right|^{\frac 12 - \sigma}
                |.

            p
                me f(s) = \zeta(s) \zeta(1-s)
                | + Phragmén-Lindelöf, bound it on #[m a = -\epsilon, b=  1+ \epsilon]:
                me |f(s)| \le |t|^{1/2 +\delta}
                | .

section#sec-linnik
    title Linnik's theorem

    introduction: p
        | We will mostly follow Ellenberg, Michel, Venkatesh.
        | Linnik's ergodic method and the distribution of integer points on spheres.

    subsection#subsec-linnik
        title Linnik's theorem

        paragraphs
            title Problem

            aside: p Lecture 16 6/11/2018
            p
                | Distribution of
                me \mathscr H_d = \{ (x,y,z) \in \ZZ^3 : x^2 + y^2 + z^2 = d\}
                | as #[m d \to \infty].
            theorem
                title Linnik
                statement: p
                    | As #[m d \to \infty] squarefree such that #[m d\not\equiv 7 \pmod 8],  #[m d \equiv \pm 1 \pmod 5]
                    me \left\{ \frac {x}{\sqrt d} : x \in \mathscr H_d \right\}
                    | is equidistributed w.r.t. the Lebesgue measure
                    me \operatorname{red}_\infty \colon \mathscr H_d \to S^2
                    me \frac{|\operatorname{red}_\infty\inv (\Omega)|}{|\mathscr H_d|}  \to \operatorname{Vol} (\Omega)
                    | in the sense that
                    me \frac{|\operatorname{red}_\infty\inv (\Omega)|}{|\mathscr H_d|}  = \operatorname{Vol} (\Omega) ( 1 + o(1))
                    | for any #[m \Omega] a reasonable subset of #[m S^2].

            p
                | The #[m \pm 1\pmod 5] condition comes from a splitting condition in #[m \QQ(\sqrt{d})] that we need to find an appropriate group action.

            p
                | We will rather focus on the following variant
            theorem
                title Linnik variant
                statement: p
                    me \overline{\mathscr H}_d = \{ (x,y,x) \pmod q : (x,y,z)\in \mathscr H_d\}
                    | with #[m q] fixed #[m \gt 0] and #[m (q,30)  =1] (non-essential).
                    | As #[m d \to  \infty], #[m d] squarefree such that #[m d \not \equiv 7 \pmod 8] and #[m d \equiv \pm 1 \pmod 5].
                    | #[m \overline {\mathscr H}_d(q)] becomes equidistributed in #[m \mathscr H_d(q) = \{ (x,y,z ) \in (\ZZ/q)^3 : x^2 + y^2 + z^2 = d\}] w.r.t. counting measure, explicitly
                    me \frac{| \operatorname{red}\inv_q(x)|}{| \mathscr H_d|} = \frac{1}{|\mathscr H_d(q)|} ( 1+ o(1))
                    | as #[m d \to \infty].

            p
                | Actually we will prove something a little strange.

            definition#def-deviation
                title Deviation
                statement
                    p
                        | #[m \infty], let #[m \rho \gt 0], #[m x\in S^2] and consider the cap #[m \Omega(x,\rho)].
                        me \operatorname{dev}_d(\Omega) = \frac {1}{\operatorname{Vol}(\Omega)} \frac{| \operatorname{red}\inv_\infty(\Omega)|}{|\mathscr H_d|} - 1
                        | (we want to show this is #[m o(1)]).
                    p
                        | #[m q], let #[m \bar x \in \mathscr H_d(q)] then
                        me \operatorname{dev}_d(\bar x) = \frac {| \mathscr H_d(q)| | \operatorname{red}\inv_q(\bar x)|}{|\mathscr H_d|} - 1
                        |.
                        // TODO check here

            theorem
                statement: p
                    | Fix #[m \delta, \eta \gt 0] then for every
                    me \rho \ge d^{-1/4 + \eta}
                    me \frac 1q  \ge d^{-1/4 + \eta}
                    | #[m (q,30) = 1], then as #[m d\to \infty]
                    me \mu_{S^2}(x : \operatorname{dev}_d(\Omega(x, \rho)) \ge \delta) \to 0
                    me \frac{| \{ \bar x \in \mathscr H_d(q) : \operatorname{dev}_d(\bar x) \ge \delta \} |}{ |\mathscr H_d(q)|} \to 0
                    | .
            p
                | How?
                | Sketch of the argument:
            p
                | Fix #[m \delta ,\eta \gt 0],
                me B_\delta = \{ \bar x \in \mathscr H_q(d) : \operatorname{dev}_d(\bar x) \gt \delta \}
                | and assume that
                me  |B_\delta| \ge \eta |\mathscr H_d(q)|
                | .
            p
                | Inputs
                ol
                    li
                        | There is an action of #[m H(d) = ] class group of #[m \QQ(\sqrt{-d})] on #[m \mathscr H_d(q)/ \specialorthogonal_3(\ZZ)].
                        | As #[m d \equiv \pm 1 \pmod 5] so #[m (5) = \ideal p \bar{\ideal p}] in #[m \QQ(\sqrt{-d})]:
                        | This gives us a well defined dynamical system by considering the action
                        me \mathscr H_d(q) \ni  x \xrightarrow {\ideal p} x_1 \to x_2 \to x_2 \to \cdots
                        | and in reverse
                        me x_{-2} \to x_{-1} \to x  \xrightarrow {\ideal p} x_1 \to x_2 \to x_2 \to \cdots
                        | call this chain #[m \gamma_X] and for any #[m l \gt 0 \in \ZZ]
                        me \gamma_X^{(l)} = [x_{-l}, x_{-l + 1}, \ldots, x_{-1} ,  x,x_1, \ldots, x_l]
                    li
                        | Consider the average on
                        me B_\delta = \gamma_X^{(l)} \cap B_\delta
                        | .
                        | On one hand the expected size of #[m \gamma_X^{(l)} \cap B_\delta] is
                        me \frac{1}{|\mathscr H_d|} \sum_{x \in \mathscr H_d} | \gamma_X^{(l)} \cap B_\delta|
                        | on the other hand the expectation is
                        me \frac{(2l+ 1)}{|\mathscr H_d|} \operatorname{red}_q\inv (B_\delta)
                        | .
                        | i.e.
                        me \frac{1}{|\mathscr H_d|} \sum_{x\in \mathscr H_d} \frac{|\gamma_X^{(l)} \cap B_\delta|}{2l + 1} = \frac{| \operatorname{red}\inv_q(B_\delta)|}{|\mathscr H_d|}
                    li
                        | Since we assume that the deviation set is large (#[m \operatorname{dev}_d(x)  \gt \delta]) this implies on average
                        me \frac{| \gamma_X^{(l)} \cap B_\delta|}{2l+1}
                        | is large,
                        | gives a lower bound for this.
                    li
                        | Then we count  #[m \gamma_X^{(l)}] in another way, action of #[m H(d)] on #[m \mathscr H_d] and on #[m \mathscr H_d(q)].
                        | action of #[m \ideal p] induces a graph structure on #[m \mathscr H_d(q)].
                        | Then #[m \gamma_X^{(l)}] is a path on #[m \mathscr H_d(q)] which is non-backtracking.
                        | Count these:
                        | Inputs: for #[m l \sim  \log(d)] the number of non-backtracking paths for which #[m |\gamma_X^{(l)} \cap B_\delta|/(2l+1)] is large is #[m \gg d^{1/2 + \epsilon}].
                        | Count the total number of non-backtracking paths of length #[m 2l+1] for which
                        me \left| \frac{|\gamma_X^{(l)} \cap B_\delta|}{2l+1 } - \frac{|B_\delta|}{|\mathscr H_d(q)|} \right| \gt \delta\eta/2
                        | There can not be too many of these.
                        | This will give a contradiction.
                        | Will take some work and depend on many things.

        aside: p Lecture 17 8/11/2018

        paragraphs
            title Class group actions

            p
                me \mathscr H_d  = \{ (x,y,z ) \in \ZZ^2:  x^2 + y^2+  z^2 = d \}

            p
                | Aim:
                ol
                    li
                        | #[m \widetilde {\mathscr H}_d^*] is a principal homogeneous space  for #[m H(d) = \Cl(\QQ(\sqrt{-d}))].
                    li
                        | Describe the action explicitly.

            definition#def-prin-homog-sp
                title Principal homogeneous spaces
                statement: p
                    | Let #[m G] be a group, #[m X \ne \emptyset] a set.
                    | #[m X] is a #[term principal homogeneous space] for #[m G]
                    | if
                    me G\acts X
                    | in a transitive, free manner.
                    | #[m X] is also called a #[m G]-#[term torsor].

            remark: p
                | Of #[m G] is non-abelian we have notions of a left-torsor and right-torsor.

            example: statement: p: ul
                li #[m G] is a #[m G]-torsor
                li #[m G= V] a #[m n]-dimensional vector space then #[m \aff^n]  is a #[m G]-torsor
                li #[m G = \mu_n] then #[m X(2) =  \{ x \in \CC: x^n = 2\}]

            note
                p
                    me \specialorthogonal_3 (\ZZ)\acts \mathscr H_d
                    me v = \begin{pmatrix} x \\ y \\  z \end{pmatrix}\in \mathscr H_d,\,\gamma \in \specialorthogonal_3 (\ZZ) \leadsto \gamma v \in \mathscr H_d
                    | .

            exercise
                statement: p
                    ol
                        li
                            me \# \specialorthogonal_3(\ZZ) =  24
                        li
                            | #[m \specialorthogonal_3(\ZZ)] has a  subgroup #[m \specialorthogonal_3^+(\ZZ)] of index 2 acting via even permutations.

            definition
                statement: p
                    me \widetilde{\mathscr H}_d = \specialorthogonal_3(\ZZ) \backslash \mathscr H_d
                    me \widetilde{\mathscr H}_d (q) = \specialorthogonal_3(\ZZ) \backslash \mathscr H_d(q)
                    me \widetilde S^2 = \specialorthogonal_3 (\ZZ) \backslash S^2
                    me.
                        \widetilde{\mathscr H}_d^*  =
                        \begin{cases}
                        \specialorthogonal_3^+(\ZZ) \backslash \mathscr H_d ,\amp d \equiv 1,2 \pmod 4 \\
                        \specialorthogonal_3(\ZZ) \backslash \mathscr H_d ,\amp d \equiv 3 \pmod 4
                        \end{cases}

            p
                | For all practical purposes we can basically assume that  #[m d \equiv 3 \pmod 4].

            proposition
                statement: p
                    | #[m \widetilde{\mathscr H}_d^* ] is a principal homogeneous space for #[m H(d)].
                    | Idea: Venkov 1922: Use quaternion algebras.

        paragraphs
            title Digression: Hamilton Quaternions

            p
                me B  = \{ u  + ia  + jb + kc : u,a,b,c \in \RR\}
                me \bar x =  u - ia - j b - kc
                me N(x) = x\bar x = u^2 + a^2 + b^2 + c^2
                me \trace (x) = x + \bar x =  2u
                me B^{(0)} = \{ x\in B : \trace (x) =  0\}
            p
                | Note
                me N(x) =a^2 + b^2 + c^2 \text{ if } x \in  B^{(0)}
                |.
            p
                me B^\times  = \text{units} ,\, B^1 = \{ x \in B : N(x)= 1\}
                me PB^\times = B^\times/ Z(B^\times)

            remark
                p
                    me B^\times \acts B^{(0)}
                    | via conjugation.

            exercise
                statement: p
                    me  1 \to Z(B^\times) \to B^\times \to PB^\times \simeq \specialorthogonal_3 (\QQ)  \to 1

            definition
                title Hurwitz quaternions
                statement: p
                    me B(\ZZ) = \ZZ[ i ,j, \frac{i+j+ k}{2} ]
            p
                | The Lipschitz quaternions are
                me \ZZ[ i ,j, k]
                |.
            p
                ol
                    li
                        | #[m B(\ZZ)] is a maximal order
                    li#item-hurwitz-quat-euc-dom
                        | #[m B(\ZZ)] is a Euclidean domain
                    li
                        | Lipschitz quaternions are not a Euclidean domain
            exercise
                statement: p
                    ol
                        li
                            | Show these properties.
                        li
                            | Show #[m \Cl(\ZZ\lb i, j, k \rb)   =2].
            p
                | #[xref(ref="item-hurwitz-quat-euc-dom")/] implies #[m B(\ZZ)] is a PID

                me (\QQ^3, a^2+ b^2+  c^2) \simeq (B^{(0)}, N)
                | as metric spaces
            p
                | The image of
                me B^\times(\ZZ) \to \specialorthogonal_3(\ZZ)
                | is #[m \specialorthogonal_3^+(\ZZ)].

        paragraphs
            title The action of #[m H(d)]


            p
                | Start with #[m x = (a,b,c) \in \mathscr H_d].
                | This gives rise to an embedding
                me \iota_x \colon \QQ(\sqrt{-d}) \hookrightarrow B
                me \sqrt{-d} \mapsto  x + ai + bj + ck
                | note #[m x^2 = -d].

            p
                | Let #[m K= \QQ(\sqrt{-d})]
                | #[m \iota_x] is integral ion the sense that if
                me \ints_x = B(\ZZ) \cap \QQ \lb x \rb
                | then
                me \iota\inv (\ints_x) = \ints_K
                | .

            exercise: statement: p Prove this


            p
                | #[m I \in H(d) \leadsto y= y(x,I)]
            p
                | Consider #[m B(\ZZ) \iota_x(I) = B(\ZZ) q] for some #[m q\in B(\QQ)].
                | Since #[m B(\ZZ)] is a PID.
            p
                | Then #[m y = q xq\inv\in \mathscr H_d]

            note
                p
                    ol
                        li: me y^2 = -d
                        li
                            | If we take #[m \lambda I] for #[m \lambda \in K^\times], #[m y(x, \lambda I) = y(x, I)]
                            | so we get a well defined construction #[m H(d)].
                        li
                            | #[m q] is defined up to conjugation by #[m B(\ZZ)^\times].

            p
                | To sum up:
            p
                | For any #[m x \in \mathscr H_d] we have a well defined map
                me \Cl(d) \to \widetilde{\mathscr H}_d^\times
                me I \mapsto y(x,I)
                | .

            claim
                statement: p
                    | This map makes #[m \widetilde{\mathscr H}_d^\times] a principal homogeneous space over #[m \Cl(d)].
            p
                | Let #[m x,y \in \mathscr H_d].

            p
                | Construct an ideal #[m \Lambda_{x\mapsto y}] s.t. #[m y(x,\Lambda_{x\mapsto y}) = y].

            definition
                statement: p
                    me \Lambda_{x\mapsto y} = \{ \lambda \in B(\ZZ) : x \lambda =  \lambda y \}
                    | .

            p
                | #[m x, y \in \mathscr H_d]
                | Witt's theorem implies there exists #[m q \in PB^\times(\QQ) = \specialorthogonal_3(\QQ)] s.t.
                ul
                    li: me y = q\inv x q
                    li: me \Lambda_{x\mapsto y} = B(\ZZ) \cap \QQ [x] q

            note: p
                | #[m \Lambda_{x\mapsto y} ] is locally free and rank 1
                me \implies [\Lambda_{x \mapsto y}] \in \Pic(\ints_x)  \simeq \Pic(\ints_K) \simeq \Cl(d)
                | .














        aside: p Lecture 18 13/11/2018

        p
            |Summary #[m \widetilde {\mathscr H_d}^*] is a principal homogeneous space for #[m \Cl(d)], the class group of #[m \QQ(\sqrt{-d})].

        p
            | How?
            | #[m x\in\mathscr H_d] defined
            me \QQ(\sqrt{-d}) \xhookrightarrow i B(\QQ)
            me \sqrt{-d} \mapsto x
            | any #[m I \in \Cl(d) \leadsto B(\ZZ) i(I) = B(\ZZ) q] for some #[m q].
        p
            me B(\ZZ) = \{ x + ai +bj + ck : a,b,c,d \in \ZZ, \text{ or all }\in \frac 12\ZZ\smallsetminus \ZZ\}
            me y=  q\inv x q
            me I x=  y
            me [ \Lambda_{x\mapsto y}]
            |inverse of this construction
            me \specialorthogonal(3, \QQ) \simeq PB^\times (\QQ)
        proposition
            statement: p
                | #[m \widetilde { \mathscr H_d}^*] is a principal homogeneous space for #[m \Cl(d)].
                me \widetilde { \mathscr H_d} =  \widetilde { \mathscr H_d}^*
                | if #[m d \equiv 3 \pmod 4].

                | The stabiliser of any point in #[m \widetilde { \mathscr H_d}] is the order 2 subgroup generated by #[m \ideal p | (2)].
                me \implies |\mathscr H_d | = 24 |h(d)| \text{ if } d \equiv 3 \pmod4
                me          |\mathscr H_d | = 12 |h(d)| \text{ if } d \equiv 1,2 \pmod4
            proof: p
                | Requires checking everything works as intended, it is local.

        paragraphs
            title Explicit realization

            p
                me P \in \Cl(d)
                me \leadsto M_P \in \specialorthogonal(3)

                me x\in \mathscr H_d \implies Px = M_P x
                me x = \begin{pmatrix} a\\b\\c \end{pmatrix}
            p
                |Let
                me P \bar P = (5)
                | because of the assumption on #[m d].

            p
                | #[m P] action, let #[m x\in\mathscr H_d].
                me N(P) = 5\leadsto q \in B(\ZZ)
                me N(q) = 5 \implies 5 \in \{1\pm2i, 1\pm2j,1\pm2k\}B^\times(\ZZ)
                | two of these will give you the action of #[m P, \bar P].

        example
            statement: p
                | #[m q] will act by #[m q\inv x q] acting on #[m B^{(0)}], enough to check the action on #[m i,j,k].
                | Say
                me q  = 1+2i,\bar q = (1-2i)/5
                me \bar q j q = \frac{(1-2i)}{5} j (1+2i)
                me = \frac{j- 2k}{5} 1+2i
                me j-2k - 2k - 2j????????
        paragraphs
            title Basic construction
            p
                | Let #[m \mathscr A_5 = \{M_1^\pm, M_2^\pm, M_3^\pm\}] starting with a solution #[m x\in \mathscr H_d] one gets two matrices #[m \omega_1, \omega_{-1} \in\mathscr A_5]
                me x_{-3} \xleftarrow{\omega_{-3}} x_{-2} \xleftarrow{\omega_{-2}} x_{-1} \xleftarrow{\omega_{-1}} x \xrightarrow{\omega_{1}}x_1 \xrightarrow{\omega_{2}}x_2 \xrightarrow{\omega_{3}} x_3
                | where #[m w_1] comes from #[m P] and #[m w_{-1}] from #[m \bar P].

            p
                | This construction gives a well-defined (up to flip) path starting with a solution #[m x \in \mathscr H_d].

            remark
                p
                    | These chains are periodic.
        paragraphs
            title Back to proof
            p
                | Idea: if #[m x\in\mathscr H_d] then #[m x] and these paths are well defined mod #[m p].

            p
                |We are aiming for
            proposition
                statement: p
                    | Let #[m \Sigma(d,l,q)] denote
                    me \#\{(x,x') \in \mathscr H_d\times \mathscr H_d : \gamma_x^{(l)} = \gamma_{x'}^{(l)} \text{ in } \mathscr H_d\}
                    | where
                    me \gamma_x^{(l)}\in \mathscr H_d(q)
                    | is the chain cut at #[m \lb -l,l\rb] and then reduced mod #[m q].
                    | Then
                    me \sigma (l,d,q)  \ll_\epsilon |\mathscr H_d| + d^\epsilon (1+ \frac{d}{q^2 5^{2l}})
                proof: p
                    | Next time, Linnik's lemma #[m \#\{xy = d\} \le d^\epsilon].
                    | One more input.

        aside: p Lecture 19 27/11/2018
        p
            | In #[m \QQ(\sqrt d)] we have #[m (5) = \ideal p \bar{ \ideal p}]
            me x \in \mathscr H_d = \{(x_1,x_2,x_3) : x_1^2 + x_2^2 + x_3^2 = d\}
            | there are 6 matrices #[m \mathcal A = \{A^\pm, B^\pm, C^\pm\}], #[m A,B,C \in \GL_2(\ZZ)],
            | reduction of these #[m \pmod q \acts \mathscr H_d(q)].
        p
            | This induces a graph structure on #[m \mathscr H_d(q)], (multiple edges between vertices are allowed).
            me \mathscr H_d \to \mathscr H_d(q)
            me [\ldots, x_{-1}, x_0, x_1, \ldots] \to \text{path in graph}
            | for #[m l \in \NN],
            me \gamma_x^{(l)} \subseteq \mathscr H_d(q)
            | .
        paragraphs
            title Linnik's basic lemma

            p
                | Generalisation of the following
                me r(d) = \sum_{a| d} 1 \le d^\epsilon\,\forall \epsilon
                | .

            proposition
                title Linnik
                statement: p
                    | Fix #[m d], let #[m c\in \ZZ], s.t. #[m |c| \lt d].
                    | Then #[m \forall \epsilon \gt 0],
                    me \#\{ (x_1,x_2) \in\mathscr H_d^2 : x_1\cdot x_2 = e\} \ll_\epsilon d^\epsilon
                    | .
                proof
                    p
                        | Short detour on representations of quadratic forms by other quadratic forms.

            definition
                statement: p
                    | Let #[m (Q, \ZZ^m)], #[m (R, \ZZ^n)], #[m m\ge n] be nondegenerate quadratic forms.
                    | Then #[m Q] is said to represent #[m R] if there exists a  #[m \ZZ]-linear map
                    me \iota\colon \ZZ^n \to \ZZ^m
                    | s.t.
                    me Q(\iota(x)) = R(x)\,\forall x\in \ZZ^n
                    | .

            example
                statement: p
                    me Q(x,y) = x \cdot y
                    me R(x) = d x^2
                    | then let
                    me \iota\colon \ZZ \to \ZZ^2
                    me x \mapsto (ax,bx) \text{ where } ab =d
                    | then
                    me Q(\iota(x)) = R(x)
                    | .

            p
                | Let #[m x_1, x_2 \in \mathscr H_d] s.t. #[m x_1\cdot x_2 =e].
                me x_1=(a_1,b_1,c_1)\, x_2=(a_2,b_2,c_2)
                |consider
                me \iota \colon \ZZ^2 \to \ZZ^3
                me (u,v) \mapsto (u a_1 + v a_2, u b_1 + u b_2, u c_1 + v c_2) = u x_1 + v x_2
                | let #[m Q(a,b,c) = a^2  + b^2 + c^2].
                me Q(\iota(u,v)) = (u a_1 + v a_1)^2 + (u b_1 + v b_2)^2 + (u c_1 + v c_2)^2
                me = du^2 + 2euv + dv^2
                me = R_{d,e} (u,v)
                | .
            p
                | So the number of representations of #[m R] by #[m Q/ \specialorthogonal_3(\ZZ)] bounds number of solutions #[m x_1 x_2 = e].

            theorem
                title Gordon Pell 1949
                statement: p
                    | Let
                    me r(a,b,c) = \{ \text{reps. of } ax^2 + bxy + cy^2 \text{ by } x^2 + y^2 + z^2\}
                    | then
                    me r(a,b,c) = 24 \cdot 2^\nu \prod_{p| 2(b^2 - 4ac)} r_p(a,b,c)
                    |  where
                    me \nu = \#\text{primes dividing } b^2 - 4ac
                    me r_p(a,b,c) = O(1) \text{ unless } p^2 | \gcd(a,b,c)
                    | for us #[m r(d,2e,d)], #[m b^2 - 4ac = 4(e^2 - d^2)] and
                    me r(d,2e,d) \ll_\epsilon d^\epsilon
                    | .

            exercise
                statement: p
                    | Show this (recall #[m d] is a fundamental discriminant).

            lemma
                title Shadowing lemma
                statement: p
                    | Let
                    me [x_{-l},\ldots, x_0, x_1 ,\ldots, x_l], [x'_{-l},\ldots, x'_0, x'_1 ,\ldots, x'_l]
                    | be two marked paths in #[m \mathscr H_d].

                    | Then these paths have the same reduction mod #[m q] iff #[m x_0 = \pm x_0' \pmod{q5^l}].

            theorem
                statement: p
                    me \Sigma (d,l,q) = \#\{(x,x') \in \mathscr H_d^2 : \gamma_x^{(l)} = \gamma_{x'}^{(l)} \in \mathscr H_d(q)\}
                    me \implies \Sigma (d,l,q) \ll_\epsilon \# \mathscr H_d  + d^\epsilon ( 1+ \frac{d}{q^2 5^{2l}}) \,\forall \epsilon \gt 0
                    |.
                proof
                    p
                        me \gamma_x^{(l)} = \gamma_{x'}^{(l)} \implies x = \pm x' \pmod{q5^l} \text{(by the Shadowing lemma)}
                        me \implies (x+x') ( x+ x') \equiv 0 \pmod{q^2 5^{2l}}
                        | or
                        me \implies (x-x') ( x- x') \equiv 0 \pmod{q^2 5^{2l}}
                        | .
                    p
                        me \implies \Sigma(d,l,q) \ll 2\#\{(x,x') : x\ne x',\, x\cdot x' = d \pmod{q^2 5^{2l}}\}
                        | recall
                        me \sum_{|e| \lt d,\,e = d \pmod{q^2 5^{2l}} } \{(x,x') : x\cdot x' = e\} \ll_\epsilon d^\epsilon (1+ \frac{d}{q^2 5^{2l}})
                        |.

        paragraphs
            title Proof of the equidistribution statement

            p
                | Recall:
                me \operatorname{dev}_d(\bar x) = \frac { | \operatorname{red}\inv_q(\bar x)|}{|\mathscr H_d|/| \mathscr H_d(q)|} - 1
                me \operatorname{dev}_d(\bar x) \to 0\text{ as } d \to \infty,\,d \equiv \pm 1 \pmod 5\,\, d\text{ fund. disc.}
                | .

            proof
                title Sketch of proof
                p
                    | Assume #[m B_\delta = \{ \bar x : \operatorname{dev}_d)\bar x) \\gt \delta\}].
                    | Lower bound by counting the number of paths that lie in #[m \operatorname{red}\inv_q(B_\delta)].
                    | Upper bound by the expansion property of #[m \mathscr H_d(q)].


        aside: p Lecture 20 29/11/2018

        theorem
            title Linnik
            statement: p
                | Fix #[m \nu, \delta\gt 0] and let #[m q \le d^{\frac 14 - \nu}], #[m (q,30) = 1].
                | Then the fraction of #[m \bar x \in \mathscr H_d(q)] for which
                me |\operatorname{dev}_d(\bar x)| \gt \delta
                | tends to 0 as #[m d \to \infty] through #[m d \equiv \mp 1 \pmod 5].

        p
            | Recall #[xref(ref="def-deviation")/].

        p
            | Last time
        proposition
            statement: p
                | Let
                me \Sigma(d,l,q) = \# \{ (x,x') \in \mathscr H_d^2 : \gamma_x^{(l)} =\gamma_{x'}^{(l)}\}
                | then
                me \Sigma(d,l,q) \ll_\epsilon| \mathscr H_d | +  d^\epsilon \left(1+  \frac{d}{q^2 5^{2l}}\right)
                | .

        proof
            title Proof of theorem
            p
                | Let
                me B_\delta = \{ \bar x\in \mathscr H_d (q) : \operatorname{dev}_d(\bar x)  \gt \delta\}
                | and assume that
                me B_\delta  \ge \eta | \mathscr H_d(q)|
                | for some #[m \eta  \gt 0].
            p
                | Observe that
                me \frac{1}{|\mathscr H_d(q) |  } \sum_{x\in \mathscr H_d }  |\gamma_x^{(l)} \cap B_\delta | =  (2l+ 1)  \frac { | \operatorname{red}_q\inv (B_\delta)|}{|\mathscr H_d|}
                | or
                men \frac{1}{|\mathscr H_d(q) |  } \sum_{x\in \mathscr H_d } \frac{ |\gamma_x^{(l)} \cap B_\delta | }{  (2l+ 1)} =   \frac { | \operatorname{red}_q\inv (B_\delta)|}{|\mathscr H_d|}
            p
                | Choose an  #[m l] s.t.
                me \frac 15 |\mathscr H_d| \le q^2 5^{2l} \le 5 |\mathscr H_d|
                | note that we can indeed choose such an #[m l].

            p
                | By definition every #[m \bar x \in B_\delta] satisfies
                me \operatorname{dev}_d(\bar x) \gt \delta
                | implies
                me \frac{ |\operatorname{red}_q\inv(\bar x)|}{ |\mathscr H_d|/|\mathscr H_d(q)|} \gt 1 + \delta
                | .

            p
                me | \operatorname{red}_q \inv(B_\delta)|  \ge \frac{ |B_\delta | |\mathscr H_d| }{ |\mathscr H_d(q)|} (1+\delta)
                | so
                me \frac{1}{|\mathscr H_d|} \sum_{x\in \mathscr H_d} \frac{|\gamma_x^{(l)} \cap B_\delta|}{(2l+1)} \gt \frac{|B_\delta|}{|\mathscr H_d(q)|}(1+\delta)
                | by the assumption that
                me B_\delta  \ge \eta | \mathscr H_d(q)|
                | we have this is
                me \ge \frac{|B_\delta|}{|\mathscr H_d(q)|}+\eta\delta
                | .
            p
                | Let
                me \Phi = \left\{ x\in \mathscr H_d : \frac{ | \gamma_x^{(l)} \cap B_\delta | }{ (2l + 1)} \gt \frac{|B_\delta|}{|\mathscr H_d(q)|} + \frac{\eta \delta }{2} \right\}
            p
                | Note that
                me \mathscr H_d  =  \Phi \sqcup \Phi^c
                me \frac{1}{|\mathscr H_d|} \sum_{x\in \mathscr H_d} \frac{ | \gamma_x^{(l)} \cap B_\delta | }{ (2l + 1)}  =  \frac{1}{|\mathscr H_d|} \left( \sum_{x\in \Phi } \underbrace{\frac{ | \gamma_x^{(l)} \cap B_\delta | }{ (2l + 1)}}_{\le 1} + \sum_{x\in \Phi^c} \underbrace{\frac{ | \gamma_x^{(l)} \cap B_\delta | }{ (2l + 1)}}_{ \le  \frac{|B_\delta|}{\mathscr H_d(q)|} + \frac{\eta \delta }{2}  }  \right)
                me \le\frac{1}{|\mathscr H_d|} \left( |\Phi | + \overbrace{| \Phi^c|}^{=|\mathscr H_d| - |\Phi|} \left( \frac{|B_\delta|}{\mathscr H_d(q)|} + \frac{\eta \delta }{2} \right)\right)
                men#eqn-phi-bd-linnik-pf \implies |\Phi| \ge  \frac{\eta \delta }{2} | \mathscr H_d|
                |.
            p
                | Now we count the number of marked non-backtracking paths on #[m \mathscr H_d(q)]  of length #[m 2l+1] (write #[m MNBP(\mathscr H_d(q))] for this quantity), which in addition satisfy
                me \frac{|\gamma_x^{(l)} \cap B_\delta|}{(2l+1)} \gt \frac{|B_\delta|}{|\mathscr H_d(q) | } +   \frac{\delta \eta}{2}
                | .
            p
                | By #[xref(ref="eqn-phi-bd-linnik-pf")/] we have #[m \eta \delta |\mathscr H_d|/2] of these paths #[q upstairs].
            p
                | Recall Siegel implies
                me d^{\frac 12 - \epsilon} \lt | \mathscr H_d| \lt d^{\frac 12 + \epsilon}
                | so upstairs we have #[m \gg_\epsilon \frac{\eta \delta }{2} d^{\frac 12 - \epsilon }] paths.

            p
                | Claim 1:
                | The previous proposition implies not mant of these paths give the same path mod #[m q]
                me MNBP(\mathscr H_d(q)) \gg_{\epsilon,\delta \eta} d^{\frac 12 - \epsilon}
                | .
            p
                | On the other hand the total number of marked non-backtracking paths on
                me \mathscr H_d(q)
                | is
                me | \mathscr H_d(q)| 6 \cdot 5^{2l -1}
                | also observe that #[m |\mathscr H_d(q)| \ll q^2]
                | so  the total number #[m \sim q^2 5^{2l} \ll d^{1/2  + \epsilon}]
                me \frac 15 |\mathscr H_d| \lt q^2 5^{2l} \lt 5 |\mathscr H_d|

            p
                | Final input is a Chernoff type bound.
        proposition
            statement: p
                | Fix #[m \eta, \epsilon \gt 0] for any subset
                me B \subseteq \mathscr H_d(q)
                | s.t.
                me | B | \ge  \eta | \mathscr H_d(q)|
                | the fraction of non-backtracking paths of length #[m 2l + 1] satisfying
                me \left| \frac{| \gamma \cap B|}{2l + 1 } - \frac{|B | }{|\mathscr H_d(q)|}  \right| \ge \epsilon
                | is
                me \ll_{\epsilon,\eta} e^{-cl}
                | for some #[m c =c(\epsilon, \eta) \gt 0].

        p
            | Claim 2: This proposition implies that the fraction
            me MNBP(\mathscr H_d(q)) \ll d^{\frac 12 - \tau}
            | for some #[m \tau \gt 0].
            | Then
            me \gg_\epsilon d^{\frac 12 - \epsilon}
            me \ll_\epsilon d^{\frac 12 - \tau}
            | give a contradiction.

        p
            | We now check some claims made above.

        claim
            title Claim 1
            statement: p
                | Bound on #[m \#\{(x,x') : \gamma_x ^{(l) } =  \gamma_{x'}^{(l)}\}]
                | gives a bound on the number of distinct paths.
            proof: p
                me \#\{ (a,a')  \in A^2 : a  \equiv a' \pmod q\} = \sum n_{a_i}
                | gives a lower bound on #[m A \pmod q].

                | To show this note that the
                me | A(q)| = | A |  - \sum_{i=1}^{|A|} \frac{n_{a_i} - 1}{n_{a_i}}  - \sum_{i=1}^{|A|} \frac 1{n_{a_i}}
                | where #[m n_{a_i} = \# \{ a \in A : a \equiv a_i \pmod q\}].



        claim
            title Claim 2
            statement: p
                | Follows from two points
                me d^{\frac 12  - \epsilon} \ll q^2 5^{2l}  \ll d^{\frac 12 + \epsilon}
                me q \lt d^{\frac 14 - \nu}

    subsection
        title The adelic picture

        aside: p Lecture 21 4/12/2018

        p
            | Notation: #[m \adeles] is the ring of adeles of #[m \QQ]
            me \prod_p' \QQ_p
            me \adeles_f = \prod_{p \text{ finite}}' \QQ_p
            | so that
            me \adeles = \RR \times \adeles_f
            | .
            me \widetilde \ZZ \colon \varprojlim_n \ZZ/n = \prod \ZZ_p
            |.

        p
            me \widehat \ZZ \subseteq \adeles_f
            | maximal compact.

        paragraphs
            title The genus of a quadratic space

            p
                | For us,
                me L\subseteq \QQ^3
                | a lattice, then
                me \GL_3(\adeles_f) \ni g = \prod g_p
                me g\cdot L = \{ \alpha \subseteq \QQ^3 : \alpha_p = g_p L_p \,\forall p\}
                me \operatorname{genus}_{\specialorthogonal_3} (\mathcal L_p) = \specialorthogonal_3(\adeles_f) \mathcal L_0
                me \mathcal L_0 = \ZZ^3,\,a^2+b^2 + c^2
                | .

            proposition
                statement: p
                    | There is one #[m \specialorthogonal_3(\QQ)] orbit of #[m \mathcal L_0].
                    | i.e.
                    me \specialorthogonal_3(\adeles_f) = \specialorthogonal_3(\QQ) \specialorthogonal_3(\widehat\ZZ)
                proof
                    p
                        | Based on quaternions having class number 1.

            p
                | More definitions:
                me P = \{ (\mathcal L, x) : \mathcal L \in \operatorname{genus}_{\specialorthogonal_3} (\mathcal L_0), x \in \mathcal L,\, x \cdot x = d\}
                me P_{(q)} = \{ (\mathcal L, \bar x) : \mathcal L \in \operatorname{genus}_{\specialorthogonal_3} (\mathcal L_0), \bar x \in \mathcal L/q\mathcal L,\, \bar x \cdot \bar x = d \pmod q\}
                me \widetilde{\mathscr H_d} \simeq \specialorthogonal_3 (\QQ) \backslash P
                me K_f [q] = \ker(\specialorthogonal_3(\widehat \ZZ) \to \specialorthogonal_3(\ZZ/q\ZZ))
                me K'_f [q] = \{ g \in \specialorthogonal_3(\widehat \ZZ) : g \bar x_q = \bar x_q\}
                | we fix a base point #[m \bar x_q \in \mathscr H_d(q)].
                | Then
                me \widetilde{\mathscr H_d}(q) \simeq \specialorthogonal_3 (\QQ) \backslash P_{(q)} \simeq  \specialorthogonal_3 (\QQ) \backslash \specialorthogonal_3(\adeles_f) / K_f'[q]
                | here we are heavily using the exceptional isomorphism
                me \specialorthogonal_3 \simeq \PGL_2
                | .

            claim
                statement: p
                    me \specialorthogonal_3(\ZZ) \backslash \mathscr H_d(q) \simeq \specialorthogonal_3(\QQ) \backslash P_{(q)}
                proof
                    title Proof sketch
                    p
                        me \specialorthogonal_3(\QQ) \acts P_{(q)} \text{ diagonally}
                        me \specialorthogonal_3(\adeles_f) = \specialorthogonal_3(\QQ) \specialorthogonal_3(\widehat \ZZ)
                        | every orbit has a representation #[m \simeq (\mathcal L_0, \bar x),\,\bar x \in \mathscr H_d(q)].
                    p
                        me (\mathcal L_0, \bar x) \simeq (\mathcal L_0, \bar x')
                        me \iff
                        me \exists \gamma  \in \underbrace{\specialorthogonal_3(\widehat \ZZ)  \cap \specialorthogonal_3(\QQ)}_{\specialorthogonal_3(\ZZ)}

            claim
                statement: p
                    me \specialorthogonal_3(\QQ) \backslash P_{(q)} \simeq \specialorthogonal_3(\ZZ) \backslash \mathscr H_d(q) / K'_f[q]
                proof
                    title Proof sketch
                    p
                        | Observe
                        me \specialorthogonal_3(\adeles_f) \acts P_{(q)}
                        | via
                        me \mathcal L \otimes \widehat \ZZ/ q\mathcal L \otimes \widehat \ZZ
                    p
                        | This action is transitive, i.e.
                        me P_{(q)} = \specialorthogonal_3(\adeles_f) [ \mathcal L_0, \bar x_q]

            remark
                p
                    me \specialorthogonal_3(\ZZ) \backslash S^3 \simeq \specialorthogonal_3(\QQ)\backslash  \specialorthogonal_3(\adeles)/ K_\infty \specialorthogonal_3(\widehat \ZZ)

            p
                | What about
                me \specialorthogonal_3(\ZZ) \backslash \mathscr H_d\text ?

                | Fix another base point #[m x_0\in \mathscr H_d]
                me \specialorthogonal_3(\ZZ) \backslash \mathscr H_d \simeq \specialorthogonal_{x_0} (\QQ) \backslash \specialorthogonal_{x_0} (\adeles_f)/ \specialorthogonal_{x_0}(\widehat \ZZ)
                | where #[m \specialorthogonal_{x_0}] is the stabiliser of #[m x_0].
                me.
                    \xymatrix{
                    \mathscr H_d \acts \text{ class gp.} \ar[d] \\
                    \mathscr H_d(a) \acts \specialorthogonal_3(\adeles_f)
                    }

            p
                | More concretely
                me \specialorthogonal_{x_0} : \QQ^3 \simeq  B^{(0)} (\QQ)
                me \specialorthogonal_3 \simeq PB^\times
                me \specialorthogonal_{x_0} \simeq PB^\times_{x_0} \simeq \langle a + b x_0 \rangle / Z
                me \simeq \Res_{K/\QQ} \mathbf G_m / \mathbf G_m
                | where #[m K = \QQ(\sqrt{-d})].

            p
                | Recall
                me K^\times \backslash \adeles_{K,f}^\times / \widehat \ints_K^\times \simeq \Pic(\ints_K)
                | .

        paragraphs
            title The graph structure on #[m \mathscr H_d(q)]

            p
                | #[m \specialorthogonal_3(\adeles_f)] is a large group, but so is #[m K_f' \lb q\rb ].
                | What is indeed true is
                me \mathscr H_d(q) \cong \Gamma_{(3,q)}   \specialorthogonal_3(\QQ_5) / K_5
                |analogous to
                me \mathbf H = \specialorthogonal_2 \backslash \SL_2(\RR)/ \SL_2(\ZZ)
                | .
            p
                | Where
                me  \Gamma_{(3,q)} PB^\times(\QQ) \cap PB^\times(\QQ_5) K_f[3,q]
                me K_{f} [3,q] = K_f[3] \cap K_f'[q] \subseteq K_f'[q]
            p
                | Now
                me \PGL_2(\QQ_5) / \PGL_2(\ZZ_5)
                | is a Bruhat-Tits tree, a 6-regular tree.


        aside: p Lecture 22 6/12/2018

        paragraphs
            title Automorphic spectrum of #[m \PGL_2] of #[m \mathbf F_q(t)]

            p
                | Analogous to #[m \SL_2(\ZZ) \backslash \HH].

            p
                | Reference I. Efrat: Automorphic spectrum on the tree of #[m \PGL_2]

            p
                | Setup: #[m k = \FF_q], #[m v_\infty =  - \deg] so #[m |f|_\infty = q^{\deg (f)}].
                me K = (k(t))_\infty = k((\frac 1t ))
                me \ints_\infty = \ints = k [[ t \inv ]]
                me \Gamma = \PGL_2(\FF_q[[t]])
            p
                | Analogies:
                me \HH \leftrightsquigarrow \PGL_2(K) / \PGL_2(\ints) = X
                me \SL_2(\ZZ) \leftrightsquigarrow \Gamma
            p
                | Problem: decompose #[m L^2(\Gamma \backslash X)].
                | In the case of
                me \SL_2(\ZZ) \backslash \HH \leadsto L^2(\SL_2(\ZZ)\backslash \HH) = \underbrace{R}_{\text{Residual}} \oplus \underbrace{C}_{\text{cusp forms}} \oplus \underbrace{E}_{\text{Eisenstein}}
                | .

            theorem
                statement: p
                    me L^2( \Gamma \backslash X) = R\oplus E
                    | #[m \dim(R) = 2,\,\dim(E) = \infty] i.e.  no cusp forms.

        paragraphs
            title Little bit on #[m X] (a #[m (q+1)]-regular tree)

            p
                | Ref: Serre #[q Trees].

            p
                | Description
                ol
                    li
                        p
                            | In terms of lattices
                            me L = \{ av_1 + bv_2 : a,b\in \ints\}
                            | s.t.
                            me L\otimes_\ints K \simeq K^2
                            | .
                        p
                            | Matrix
                            me \begin{pmatrix} v_1 \amp v_2 \end{pmatrix} \GL_2(K)
                            | changing basis implies #[m L] a class in #[m \GL_2(K) / \GL_2(\ints)].
                            me L_1 \sim L_2
                            | if #[m \exists a \in K^\times] s.t. #[m L_1 = a L_2].
                        p
                            me X = \{ \text{equivalence classes of lattices} \}
                            | A class #[m L] is adjacent to #[m L'] #[m \iff] #[m \exists] representations #[m L_0, L_0'] s.t. #[m L_0' \subseteq L_0] and #[m L_0/L_0' \simeq \FF_q].
                    li
                        p
                            | Group theoretic
                            me B = \left\{ \begin{pmatrix} * \amp * \\ 0 \amp 1 \end{pmatrix} \right\}/K

                            | Fact: #[m \PGL_2(K) = B \cdot \PGL_2(\ints)].
                            | Each coset #[m b \PGL_2(\ints)] has a representative
                            me \begin{pmatrix} t^n \amp x \\ 0 \amp 1\end{pmatrix}
                            | #[m n] unique and #[m x \in K].
                        p
                            | Vertices of #[m X]
                            me \begin{pmatrix} t^n \amp x \\ 0 \amp 1\end{pmatrix} \PGL_2(\ints)
                            me.
                                \begin{pmatrix} t^n \amp x \\ 0 \amp 1\end{pmatrix} \sim_{\text{adjacent}}
                                \begin{cases}
                                \begin{pmatrix} t^{n-1} \amp \xi t^n + x \\ 0 \amp 1\end{pmatrix},\, \xi \in \FF_q
                                \begin{pmatrix} t^{n+1} \amp x \\ 0 \amp 1\end{pmatrix}
                                \end{cases}
                        p
                            | Fact:
                            me \Gamma\backslash X = \text{chain } \bullet -\bullet - \bullet - \cdots

            p
                | Measures: Normalise Haar on #[m \PGL_2] s.t. #[m \mu(\PGL_2(\ints)) = q(q-1)].
                | #[m \leadsto] On #[m \Gamma\backslash X], #[m \mu] gives vertices weights
                me n=0: \frac{1}{q+1}
                me n=1: \frac{1}{q}
                me n=2: \frac{1}{q^2}
                me \vdots
                me n: \frac{1}{q^n}
            remark
                p
                    | We have
                    me \pair fg_\mu = \int_{\Gamma \backslash X} f \cdot \bar g \diff \mu = \frac{1}{q+1} f(0)\bar g(0) + \sum_{i=1}^\infty \frac{f(i) \bar g(i)}{q^i}
                    | .
            fact
                statement: p
                    | The algebra of operators on functions on #[m X] that commute with the automorphisms of #[m X] is generated by
                    me (T(f))(s)  = \sum_{s' \sim s} f(s')

            remark
                p
                    me \Delta = (q+1) \id - T
                    | and #[m T] descends to #[m \Gamma\backslash X].

            p
                | Given #[m f\colon \Gamma\backslash X \simeq \NN \to \CC]
                me (T(f))(n) = \begin{cases} (q+1)f(1),\amp n=0 \\ qf(n-1) + f(n+1),\amp n \gt 0 \end{cases}

            p
                | #[m T] is self-adjoint with respect to #[m \pair{}{}_\mu].

        paragraphs
            title Eigenfunctions of #[m T]

            p
                me (T f)(n) = \lambda \cdot f(n),\,\forall n \in \NN
                | .
            p
                me \implies \lambda f(0) = (q+1) f(1)
                me          \lambda f(n) = q f(n-1) + f(n+1),\,\forall n \gt 0
                | i.e.
                me \begin{pmatrix} f(n+1) \\ f(n) \end{pmatrix} = \begin{pmatrix} \lambda \amp -q \\ 1 \amp 0 \end{pmatrix}^n\begin{pmatrix} f(1) \\ f(0) \end{pmatrix}
                | .
            p
                | Now fix a normalization
                me f(0) = q+1
                me f(1) = \lambda
                |.
            p
                | Characteristic values:
                me x_1, x_2 = \frac{-\lambda \pm \sqrt{\lambda^2 - 4q}}{2}
                | note #[m x_1 = x_2 \iff \lambda = \pm 2\sqrt q].
            p
                | Eigenfunctions
                me f_\lambda (n) = \begin{cases} \frac{1}{\sqrt{\lambda^2 - 4q}} \left(\lambda( x_1^n - x_2^n) - q(q+1)(x_1^{n-1} - x_2^{n-1})\right),\amp n \gt0 \\ q+1,\amp n=0 \end{cases}
                | for #[m \lambda \ne \pm 2\sqrt q] note #[m f_{q+1} = q+1].
                me f_{2\sqrt q} (n) = (q+1 - (q-1) n)q^{n/2}
                me f_{-2\sqrt q} (n) = (-1)^n f_{2\sqrt q}
            p
                | We now consider the space #[m L^2( \Gamma\backslash X)] with the operator #[m T].
            p
                | Question: which the #[m f_\lambda] are in #[m L^2 (\Gamma\backslash X)]?

            proposition
                statement: p
                    | The only #[m f_\lambda\in L^2] with #[m |\lambda| \gt 2 \sqrt q] are #[m \lambda = \pm(q+1)].
                proof
                    p
                        | Normalise #[m f_\lambda] by
                        me (x_2 - x_1) f = x_1^{n-1} (\lambda x_1 - q(q+1)) - x_2^{n-1} (\lambda x_2 - q(q+1))
                        | assume WLOG #[m |x_1| \gt \sqrt q] #[m \implies] #[m |x_2| \lt \sqrt q] (since #[m |\lambda| \gt 2 \sqrt q])
                        | so #[m x_2^n = o(q^{n/2})].
                    p
                        | So #[m \lambda x_1 - q(q+1) = 0] (to be in #[m L^2]).
                        | So #[m \lambda = \pm q(q+1)].

            p
                | What about the rest?
            p
                | Note: #[m |\lambda|  \lt 2 \sqrt q \implies x_1 = \bar x_2].

            p
                | Renormalise: Let #[m x_1 = \sqrt q e^{i\theta},x_2 = \sqrt q e^{-i\theta}].
                me \lambda = 2\sqrt q \cos \theta,\,0 \lt \theta \lt \pi
                me \tilde f_\theta(n) = \frac{x_1 - x_2}{2\sqrt q} f_{2\sqrt q \cos \theta} (n)
                | so
                me \tilde f_\theta(n) = \begin{cases} q^{n/2} i (\sin(n+1)) \theta - q\sin(n-1) \theta\\ (q+1) i \sin \theta\end{cases}

            proposition
                statement: p
                    me \tilde f_\theta \not \in L^2
                    | for #[m 0 \lt \theta \lt \pi].

        paragraphs
            title Spectral decomposition of #[m L^2(\Gamma \backslash X)]

            p
                | Continuous spectrum: Extend #[m \tilde f_\theta] to an odd function #[m - \pi \lt \theta \lt \pi].
                | Given #[m \psi \in L^2(\Lambda\backslash X)] consider
                me F_\psi(n) = \frac{1}{2\pi} \int_{-\pi}^\pi \psi(\theta) \tilde f_\theta (n) \diff \theta
                | .

            theorem
                statement: p
                    | #[m F_\psi \in L^2(\Gamma\backslash X)].
                    me \pair{F_\psi}{F_\phi}_\mu = \pair{\psi}{\phi} \frac{1}{2\pi} \int_0^\pi \psi(x) \overline{\phi(x)} ((q-1)^2 - 4 q \sin^2(x)) \diff x

            theorem
                statement: p
                    | Let #[m g \in L^2(\Gamma \backslash X)].
                    | Then
                    me g(n) = \pair{g}{u_1} u_1(n) + \pair{g}{u_2} u_2(n) + 2 \pi \int_0^\pi \pair{g }{\tilde f _\theta} \tilde f _\theta \frac{\diff \theta}{(q-1)^2 - 4q \sin^2 \theta}
                    | where
                    me u_1 = \sqrt{\frac{q^2-1}{2q}},\, u_2 = \sqrt{\frac{q^2-1}{2q}} (-1)^n
                    | .

